[
{
	"uri": "//localhost:1313/vi/1-introduction/",
	"title": "Gi·ªõi thi·ªáu Site-to-Site VPN v·ªõi BGP v√† Redundancy",
	"tags": [],
	"description": "",
	"content": "N·ªôi dung:\nM·ª•c ti√™u c·ªßa Workshop T·ªïng quan l√Ω thuy·∫øt M√¥ h√¨nh ki·∫øn tr√∫c ƒë·ªÅ xu·∫•t T√¨nh hu·ªëng th·ª±c t·∫ø Nh·ªØng g√¨ b·∫°n s·∫Ω h·ªçc ƒë∆∞·ª£c C√°c c√¥ng c·ª• v√† d·ªãch v·ª• s·ª≠ d·ª•ng Ki·∫øn th·ª©c c·∫ßn c√≥ tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu üéØ M·ª•c ti√™u c·ªßa Workshop Workshop n√†y h∆∞·ªõng d·∫´n b·∫°n t·ª´ng b∆∞·ªõc tri·ªÉn khai m·ªôt k·∫øt n·ªëi Site-to-Site VPN gi·ªØa h·∫° t·∫ßng on-premises v√† Amazon VPC, s·ª≠ d·ª•ng BGP (Border Gateway Protocol) ƒë·ªÉ t·ª± ƒë·ªông h√≥a ƒë·ªãnh tuy·∫øn v√† ƒë·∫£m b·∫£o t√≠nh s·∫µn s√†ng cao (High Availability) nh·ªù v√†o nhi·ªÅu tunnels d·ª± ph√≤ng.\nB·∫°n c≈©ng s·∫Ω h·ªçc c√°ch:\nGi√°m s√°t tr·∫°ng th√°i VPN v√† l∆∞u l∆∞·ª£ng. T·ª± ƒë·ªông h√≥a c·∫£nh b√°o v√† x·ª≠ l√Ω s·ª± c·ªë. Ki·ªÉm th·ª≠ failover gi·ªØa c√°c tunnel. B·∫£o v·ªá tunnel v·ªõi c√°c best practice b·∫£o m·∫≠t. ∆Ø·ªõc l∆∞·ª£ng chi ph√≠ v√† t·ªëi ∆∞u h√≥a v·∫≠n h√†nh. üß† T·ªïng quan l√Ω thuy·∫øt üåê Site-to-Site VPN l√† g√¨? Site-to-Site VPN l√† m·ªôt ph∆∞∆°ng th·ª©c k·∫øt n·ªëi an to√†n gi·ªØa hai m·∫°ng ri√™ng bi·ªát th√¥ng qua internet b·∫±ng giao th·ª©c IPSec. VPN cho ph√©p c√°c m√°y ch·ªß, ·ª©ng d·ª•ng ·ªü hai ƒë·∫ßu k·∫øt n·ªëi v·ªõi nhau nh∆∞ trong c√πng m·ªôt m·∫°ng n·ªôi b·ªô.\nL·ª£i √≠ch: Kh√¥ng y√™u c·∫ßu ng∆∞·ªùi d√πng k·∫øt n·ªëi th·ªß c√¥ng nh∆∞ Client VPN, m√£ h√≥a end-to-end, duy tr√¨ k·∫øt n·ªëi ·ªïn ƒë·ªãnh 24/7.\nüß≠ BGP l√† g√¨ v√† t·∫°i sao n√™n d√πng? BGP (Border Gateway Protocol) l√† giao th·ª©c ƒë·ªãnh tuy·∫øn l·ªõp m·∫°ng ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ trao ƒë·ªïi th√¥ng tin gi·ªØa c√°c h·ªá th·ªëng m·∫°ng t·ª± tr·ªã (AS). Trong VPN, BGP mang l·∫°i:\nüß† H·ªçc route t·ª± ƒë·ªông gi·ªØa on-premises v√† AWS. üîÅ T·ª± ƒë·ªông chuy·ªÉn ƒë·ªïi ƒë∆∞·ªùng ƒëi khi tunnel l·ªói (failover). üìà T·ªëi ∆∞u h√≥a ƒë∆∞·ªùng ƒëi, ch·ªçn tuy·∫øn t·ªëi ∆∞u. üîÑ Kh√¥ng c·∫ßn c·∫≠p nh·∫≠t route th·ªß c√¥ng ‚Äì d·ªÖ m·ªü r·ªông. BGP l√† b·∫Øt bu·ªôc n·∫øu b·∫°n c·∫ßn t·ª± ƒë·ªông h√≥a ƒë·ªãnh tuy·∫øn v√† ƒë·∫£m b·∫£o t√≠nh linh ho·∫°t khi m·∫°ng m·ªü r·ªông.\nüèóÔ∏è Redundancy v·ªõi Multi-Tunnel VPN AWS cung c·∫•p 2 tunnel IPSec cho m·ªói VPN Connection. Khi s·ª≠ d·ª•ng BGP:\nN·∫øu 1 tunnel b·ªã l·ªói, BGP t·ª± ƒë·ªông chuy·ªÉn sang tunnel c√≤n l·∫°i. C·∫£ hai tunnel c√≥ th·ªÉ ho·∫°t ƒë·ªông ƒë·ªìng th·ªùi. M√¥ h√¨nh n√†y ƒë·∫£m b·∫£o ƒë·ªô tin c·∫≠y v√† t√≠nh s·∫µn s√†ng cao, ph√π h·ª£p v·ªõi c√°c t·ªï ch·ª©c y√™u c·∫ßu k·∫øt n·ªëi kh√¥ng gi√°n ƒëo·∫°n (ng√¢n h√†ng, logistics, SaaS\u0026hellip;). üß© M√¥ h√¨nh ki·∫øn tr√∫c ƒë·ªÅ xu·∫•t M·ªôt VPC tr√™n AWS (10.0.0.0/16) l√†m m·∫°ng cloud. M·ªôt thi·∫øt b·ªã m√¥ ph·ªèng on-premises router (VyOS ho·∫∑c pfSense) c√≥ IP tƒ©nh. Customer Gateway: ƒë·∫°i di·ªán thi·∫øt b·ªã on-prem. Virtual Private Gateway: g·∫Øn v·ªõi VPC. Site-to-Site VPN v·ªõi 2 ƒë∆∞·ªùng h·∫ßm h·ªó tr·ª£ BGP. CloudWatch + CloudTrail ƒë·ªÉ gi√°m s√°t tr·∫°ng th√°i. IAM Role ƒë·ªÉ ph√¢n quy·ªÅn qu·∫£n l√Ω. VPC Flow Logs ƒë·ªÉ gi√°m s√°t l∆∞u l∆∞·ª£ng. üí° T√¨nh hu·ªëng th·ª±c t·∫ø C√¥ng ty XYZ ƒëang chuy·ªÉn m·ªôt ph·∫ßn h·∫° t·∫ßng ·ª©ng d·ª•ng l√™n AWS nh∆∞ng v·∫´n duy tr√¨ h·ªá th·ªëng ki·ªÉm so√°t v√† d·ªØ li·ªáu t·∫°i trung t√¢m d·ªØ li·ªáu on-premises.\nY√™u c·∫ßu:\nLu·ªìng d·ªØ li·ªáu gi·ªØa hai m√¥i tr∆∞·ªùng ph·∫£i an to√†n v√† ·ªïn ƒë·ªãnh. H·ªá th·ªëng kh√¥ng ƒë∆∞·ª£c gi√°n ƒëo·∫°n khi m·ªôt tunnel VPN b·ªã l·ªói. C·∫ßn c∆° ch·∫ø ƒë·ªãnh tuy·∫øn ƒë·ªông khi ƒë·ªãa ch·ªâ IP tr√™n on-prem thay ƒë·ªïi. C·∫ßn gi√°m s√°t v√† x·ª≠ l√Ω l·ªói k·ªãp th·ªùi. Gi·∫£i ph√°p: Site-to-Site VPN + BGP + Monitoring + Multi-Tunnel Redundancy.\nüéì Nh·ªØng g√¨ b·∫°n s·∫Ω h·ªçc ƒë∆∞·ª£c NƒÉng l·ª±c ƒë·∫°t ƒë∆∞·ª£c M√¥ t·∫£ chi ti·∫øt ‚úÖ Thi·∫øt l·∫≠p VPN v·ªõi nhi·ªÅu tunnel T·∫°o Site-to-Site VPN connection redundancy ‚úÖ C·∫•u h√¨nh BGP hai chi·ªÅu T·ª± ƒë·ªông h·ªçc v√† qu·∫£ng b√° route ‚úÖ Failover automation Khi tunnel down, traffic t·ª± chuy·ªÉn ƒë·ªïi ‚úÖ Gi√°m s√°t tunnel v√† ƒë·ªãnh tuy·∫øn V·ªõi CloudWatch, CloudTrail ‚úÖ Theo d√µi l∆∞u l∆∞·ª£ng m·∫°ng D√πng VPC Flow Logs ‚úÖ B·∫£o v·ªá VPN connection B·∫£o m·∫≠t PSK, ph√¢n quy·ªÅn IAM ‚úÖ ∆Ø·ªõc l∆∞·ª£ng v√† t·ªëi ∆∞u h√≥a chi ph√≠ D·ª±a tr√™n usage patterns ‚úÖ Ghi ch√∫ v√† v·∫≠n h√†nh h·ªá th·ªëng Chu·∫©n h√≥a t√†i li·ªáu cho team ops üì¶ C√°c c√¥ng c·ª• v√† d·ªãch v·ª• s·ª≠ d·ª•ng Amazon VPC Virtual Private Gateway (VGW) Customer Gateway (CGW) EC2 Instance (router gi·∫£ l·∫≠p VyOS/pfSense) Site-to-Site VPN BGP Routing CloudWatch \u0026amp; CloudTrail IAM Roles \u0026amp; Policies VPC Flow Logs üõ†Ô∏è Ki·∫øn th·ª©c c·∫ßn c√≥ tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu N·∫Øm c∆° b·∫£n v·ªÅ AWS Networking: VPC, Subnets, Route Table. Bi·∫øt s·ª≠ d·ª•ng AWS Console ho·∫∑c CLI. Hi·ªÉu ki·∫øn th·ª©c c∆° b·∫£n v·ªÅ routing IP, CIDR, IPSec. C√≥ ki·∫øn th·ª©c n·ªÅn t·∫£ng v·ªÅ BGP ho·∫∑c static routing. Kinh nghi·ªám v·ªõi Linux, VyOS ho·∫∑c pfSense l√† l·ª£i th·∫ø. "
},
{
	"uri": "//localhost:1313/vi/6-site-to-site-vpn-lambda-cloudwatch/6-1-lambda-on-sts-vpn/",
	"title": "T·∫°o Lambda",
	"tags": [],
	"description": "",
	"content": "IAM Role cho Lambda (chi ti·∫øt) Ph·∫ßn n√†y h∆∞·ªõng d·∫´n r·∫•t chi ti·∫øt t·ª´ng b∆∞·ªõc ƒë·ªÉ t·∫°o IAM Role d√πng cho Lambda ph·ª•c v·ª• diagnostic khi VPN tunnel down. Role s·∫Ω c√≥:\nManaged policy AWSLambdaBasicExecutionRole (cho ph√©p ghi CloudWatch Logs), Inline policy t·ªëi thi·ªÉu cho ph√©p ec2:DescribeVpnConnections, ssm:SendCommand, ssm:GetCommandInvocation, v√† (t√πy ch·ªçn) sns:Publish. Quan tr·ªçng: ·ªü m√¥i tr∆∞·ªùng production h√£y gi·ªõi h·∫°n Resource trong policy t·ªõi ARN c·ª• th·ªÉ ƒë·ªÉ tu√¢n theo nguy√™n t·∫Øc least privilege.\nM·ªü IAM Console v√† b·∫Øt ƒë·∫ßu t·∫°o Role ƒêƒÉng nh·∫≠p AWS Management Console ‚Üí t√¨m IAM ‚Üí v√†o Roles. Nh·∫•n Create role. Ch·ªçn AWS service ‚Üí Lambda ‚Üí Next. G√°n Managed Policy cho logging ·ªû trang Attach permissions policies, t√¨m v√† tick AWSLambdaBasicExecutionRole. Click Next. ƒêi·ªÅn t√™n v√† t·∫°o role Role name: lambda-vpn-diagnostic-role (ho·∫∑c t√™n b·∫°n th√≠ch). (Optional) Th√™m tag ƒë·ªÉ qu·∫£n l√Ω (team, project). Click Create role. Th√™m inline policy (permissions t·ªëi thi·ªÉu) Trong IAM ‚Üí Roles ‚Üí m·ªü lambda-vpn-diagnostic-role ‚Üí tab Permissions ‚Üí click Add inline policy. Ch·ªçn tab JSON v√† d√°n policy sau (m·∫´u; thay Resource b·∫±ng ARN c·ª• th·ªÉ khi l√†m production): { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Sid\u0026#34;: \u0026#34;EC2DescribeAndVPN\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;ec2:DescribeVpnConnections\u0026#34;, \u0026#34;ec2:DescribeInstances\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Sid\u0026#34;: \u0026#34;SSMRunCommands\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;ssm:SendCommand\u0026#34;, \u0026#34;ssm:GetCommandInvocation\u0026#34;, \u0026#34;ssm:ListCommandInvocations\u0026#34;, \u0026#34;ssm:ListCommands\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:ec2:*:*:instance/*\u0026#34;, \u0026#34;arn:aws:ssm:*:*:document/AWS-RunShellScript\u0026#34;, \u0026#34;arn:aws:ssm:*:*:managed-instance/*\u0026#34; ] }, { \u0026#34;Sid\u0026#34;: \u0026#34;OptionalSNSPublish\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;sns:Publish\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; } ] } Click Review policy ‚Üí ƒë·∫∑t t√™n (v√≠ d·ª• lambda-vpn-diagnostic-inline) ‚Üí Create policy. Ghi ch√∫: n·∫øu kh√¥ng d√πng SNS ƒë·ªÉ forward k·∫øt qu·∫£, h√£y x√≥a block OptionalSNSPublish.\nKi·ªÉm tra Trust Relationship Trong IAM ‚Üí Roles ‚Üí ch·ªçn lambda-vpn-diagnostic-role ‚Üí tab Trust relationships. Trust policy ph·∫£i cho ph√©p lambda.amazonaws.com assume role. M·∫´u: { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Service\u0026#34;: \u0026#34;lambda.amazonaws.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34; } ] } N·∫øu kh√°c, click Edit trust relationship v√† c·∫≠p nh·∫≠t. (T√πy ch·ªçn) T·∫°o b·∫±ng CLI N·∫øu b·∫°n mu·ªën script ho√°:\n# T·∫°o role aws iam create-role --role-name lambda-vpn-diagnostic-role --assume-role-policy-document file://trust.json # Attach managed policy aws iam attach-role-policy --role-name lambda-vpn-diagnostic-role --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole # Put inline policy aws iam put-role-policy --role-name lambda-vpn-diagnostic-role --policy-name lambda-vpn-diagnostic-inline --policy-document file://inline-policy.json T·∫°o Lambda function (vpn-diagnostic-handler) H∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc t·∫°o Lambda function, c·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng, timeout/memory, d√°n m√£, deploy v√† test ‚Äî t·∫•t c·∫£ th·ª±c hi·ªán trong AWS Management Console.\nChu·∫©n b·ªã VPN_ID (v√≠ d·ª• vpn-0abcd1234) - s·∫Ω d√πng trong ec2.describe_vpn_connections. EC2_INSTANCE_ID (v√≠ d·ª• i-0123456789abcdef0) ‚Äî EC2 ph·∫£i l√† SSM managed instance (SSM Agent + IAM Instance Profile AmazonSSMManagedInstanceCore). ONPREM_PRIVATE_IP (v√≠ d·ª• 192.168.100.10) ‚Äî IP n·ªôi b·ªô on‚Äëprem ƒë·ªÉ ping/traceroute. REGION (v√≠ d·ª• ap-southeast-1). Role IAM: lambda-vpn-diagnostic-role (ƒë∆∞·ª£c t·∫°o ·ªü ph·∫ßn L). T·∫°o function M·ªü AWS Console ‚Üí Lambda ‚Üí Create function.\nCh·ªçn Author from scratch.\nƒêi·ªÅn:\nFunction name: vpn-diagnostic-handler Runtime: Python 3.11 (ho·∫∑c 3.9) Permissions: Use an existing role ‚Üí ch·ªçn lambda-vpn-diagnostic-role. Click Create function.\nCh√∫ √Ω: t·∫°o function t·∫°i region ph√π h·ª£p v·ªõi EC2/VPN ƒë·ªÉ tr√°nh cross-region issues.\nThi·∫øt l·∫≠p Environment variables Trong function ‚Üí Configuration ‚Üí Environment variables ‚Üí Edit ‚Üí Add environment variables:\nVPN_ID = vpn-xxxxxxxx EC2_INSTANCE_ID = i-0123456789abcdef0 ONPREM_PRIVATE_IP = 192.168.100.10 REGION = ap-southeast-1 FORWARD_SNS_ARN = `` (n·∫øu mu·ªën publish summary t·ªõi SNS, ƒë·∫∑t ARN) Save.\nB·∫£o m·∫≠t: kh√¥ng l∆∞u Pre-Shared Key (PSK) v√†o bi·∫øn m√¥i tr∆∞·ªùng. N·∫øu c·∫ßn s·ª≠ d·ª•ng PSK ho·∫∑c webhook secrets, l∆∞u trong AWS Secrets Manager.\nC·∫•u h√¨nh Timeout \u0026amp; Memory V√†o Configuration ‚Üí General configuration ‚Üí Edit:\nTimeout: 120 seconds (tƒÉng n·∫øu mu·ªën ch·ªù l√¢u h∆°n) Memory: 256 MB Save.\nD√°n m√£ Lambda (Code) Trong Code ‚Üí Code source, m·ªü file lambda_function.py (editor) v√† d√°n ƒëo·∫°n m√£ sau: import os import time import json import boto3 import logging logger = logging.getLogger() logger.setLevel(logging.INFO) ssm = boto3.client(\u0026#39;ssm\u0026#39;) ec2 = boto3.client(\u0026#39;ec2\u0026#39;) sns = boto3.client(\u0026#39;sns\u0026#39;) # Read env VPN_ID = os.environ.get(\u0026#39;VPN_ID\u0026#39;) EC2_INSTANCE_ID = os.environ.get(\u0026#39;EC2_INSTANCE_ID\u0026#39;) ONPREM_PRIVATE_IP = os.environ.get(\u0026#39;ONPREM_PRIVATE_IP\u0026#39;) REGION = os.environ.get(\u0026#39;REGION\u0026#39;) or boto3.session.Session().region_name FORWARD_SNS_ARN = os.environ.get(\u0026#39;FORWARD_SNS_ARN\u0026#39;) # optional def run_ssm_command(instance_id, commands, timeout=60): resp = ssm.send_command( InstanceIds=[instance_id], DocumentName=\u0026#34;AWS-RunShellScript\u0026#34;, Parameters={\u0026#34;commands\u0026#34;: commands}, TimeoutSeconds=timeout ) cmd_id = resp[\u0026#39;Command\u0026#39;][\u0026#39;CommandId\u0026#39;] logger.info(f\u0026#34;SSM command sent: CommandId={cmd_id}\u0026#34;) end_time = time.time() + timeout while time.time() \u0026lt; end_time: try: inv = ssm.get_command_invocation(CommandId=cmd_id, InstanceId=instance_id) status = inv.get(\u0026#39;Status\u0026#39;) logger.info(f\u0026#34;Invocation status: {status}\u0026#34;) if status in (\u0026#39;Success\u0026#39;, \u0026#39;Failed\u0026#39;, \u0026#39;Cancelled\u0026#39;, \u0026#39;TimedOut\u0026#39;): return inv except ssm.exceptions.InvocationDoesNotExist: pass time.sleep(1) raise TimeoutError(\u0026#34;SSM command invocation timed out\u0026#34;) def describe_vpn(vpn_id): resp = ec2.describe_vpn_connections(VpnConnectionIds=[vpn_id]) return resp.get(\u0026#39;VpnConnections\u0026#39;, []) def build_response_summary(event, vpn_info, ssm_result): summary = { \u0026#34;event\u0026#34;: event if isinstance(event, dict) else str(event), \u0026#34;vpn_info\u0026#34;: vpn_info, \u0026#34;ssm_result\u0026#34;: { \u0026#34;Status\u0026#34;: ssm_result.get(\u0026#39;Status\u0026#39;) if isinstance(ssm_result, dict) else ssm_result, \u0026#34;StandardOutputContent\u0026#34;: ssm_result.get(\u0026#39;StandardOutputContent\u0026#39;) if isinstance(ssm_result, dict) else None, \u0026#34;StandardErrorContent\u0026#34;: ssm_result.get(\u0026#39;StandardErrorContent\u0026#39;) if isinstance(ssm_result, dict) else None } } return summary def lambda_handler(event, context): logger.info(\u0026#34;Received event: %s\u0026#34;, json.dumps(event)) try: alarm_name = event.get(\u0026#39;detail\u0026#39;, {}).get(\u0026#39;alarmName\u0026#39;) or event.get(\u0026#39;AlarmName\u0026#39;) except Exception: alarm_name = None logger.info(f\u0026#34;Alarm name: {alarm_name}\u0026#34;) vpn_info = [] try: if VPN_ID: vpn_info = describe_vpn(VPN_ID) else: vpn_info = {\u0026#34;error\u0026#34;: \u0026#34;VPN_ID not set in environment\u0026#34;} except Exception as e: logger.exception(\u0026#34;Error describing VPN: %s\u0026#34;, e) vpn_info = {\u0026#34;error\u0026#34;: str(e)} ssm_result = {} if EC2_INSTANCE_ID and ONPREM_PRIVATE_IP: commands = [ f\u0026#34;echo \u0026#39;==== ping to {ONPREM_PRIVATE_IP} ====\u0026#39;\u0026#34;, f\u0026#34;ping -c 10 {ONPREM_PRIVATE_IP} || true\u0026#34;, f\u0026#34;echo \u0026#39;==== traceroute to {ONPREM_PRIVATE_IP} ====\u0026#39;\u0026#34;, f\u0026#34;traceroute -n {ONPREM_PRIVATE_IP} || true\u0026#34; ] try: inv = run_ssm_command(EC2_INSTANCE_ID, commands, timeout=120) ssm_result = { \u0026#34;Status\u0026#34;: inv.get(\u0026#39;Status\u0026#39;), \u0026#34;StandardOutputContent\u0026#34;: inv.get(\u0026#39;StandardOutputContent\u0026#39;), \u0026#34;StandardErrorContent\u0026#34;: inv.get(\u0026#39;StandardErrorContent\u0026#39;) } except Exception as e: logger.exception(\u0026#34;SSM command failed: %s\u0026#34;, e) ssm_result = {\u0026#34;error\u0026#34;: str(e)} else: ssm_result = {\u0026#34;error\u0026#34;: \u0026#34;EC2_INSTANCE_ID or ONPREM_PRIVATE_IP not configured\u0026#34;} summary = build_response_summary(alarm_name or event, vpn_info, ssm_result) logger.info(\u0026#34;Diagnostic summary: %s\u0026#34;, json.dumps(summary)) if FORWARD_SNS_ARN: try: sns.publish(TopicArn=FORWARD_SNS_ARN, Message=json.dumps(summary), Subject=f\u0026#34;VPN Diagnostic: {alarm_name}\u0026#34;) except Exception as e: logger.exception(\u0026#34;Failed to publish SNS: %s\u0026#34;, e) return { \u0026#34;statusCode\u0026#34;: 200, \u0026#34;body\u0026#34;: summary } Click Deploy (g√≥c ph·∫£i) ƒë·ªÉ l∆∞u code. Thi·∫øt l·∫≠p quy·ªÅn resource-based policy cho Lambda (EventBridge invoke) Th√¥ng th∆∞·ªùng EventBridge s·∫Ω t·ª± ƒë·ªông th√™m quy·ªÅn invoke. N·∫øu EventBridge kh√¥ng th·ªÉ invoke Lambda, th√™m quy·ªÅn th·ªß c√¥ng b·∫±ng CLI: aws lambda add-permission \\ --function-name vpn-diagnostic-handler \\ --statement-id eventbridge-invoke \\ --action \u0026#34;lambda:InvokeFunction\u0026#34; \\ --principal events.amazonaws.com \\ --source-arn arn:aws:events:\u0026lt;region\u0026gt;:\u0026lt;account-id\u0026gt;:rule/alarm-vpn-tunnel1-to-lambda Test Lambda c∆° b·∫£n Lambda ‚Üí ch·ªçn function vpn-diagnostic-handler ‚Üí Test. T·∫°o test event (v√≠ d·ª• {} ho·∫∑c m·∫´u CloudWatch Alarm event). Run ‚Üí ki·ªÉm tra Monitoring ‚Üí View logs in CloudWatch ƒë·ªÉ xem output v√† SSM invocation details. Troubleshooting nhanh N·∫øu SSM invocation tr·∫£ l·ªói: ki·ªÉm tra EC2 instance role (AmazonSSMManagedInstanceCore), SSM Agent c√†i v√† VPC access (internet ho·∫∑c VPC endpoint). N·∫øu ec2.describe_vpn_connections tr·∫£ l·ªói permission: ki·ªÉm tra inline policy ƒë√£ attach. T·∫°o Lambda Function (Console) Lambda s·∫Ω nh·∫≠n s·ª± ki·ªán t·ª´ EventBridge/CloudWatch Alarm, g·ªçi SSM ƒë·ªÉ ch·∫°y ping/traceroute t·ª´ EC2 test, v√† ghi k·∫øt qu·∫£ v·ªÅ CloudWatch Logs (v√† c√≥ th·ªÉ publish t·ªõi SNS n·∫øu c·∫ßn).\nChu·∫©n b·ªã EC2 test instance ƒë√£ c√†i SSM Agent v√† c√≥ IAM Instance Profile g·∫Øn AmazonSSMManagedInstanceCore. Ghi ra: VPN_ID (V√≠ d·ª• vpn-xxxxxxxx), EC2_INSTANCE_ID (V√≠ d·ª• i-0123456789abcdef0), ONPREM_PRIVATE_IP (v√≠ d·ª• 192.168.100.10). T·∫°o function M·ªü AWS Console ‚Üí Lambda ‚Üí Create function ‚Üí Author from scratch.\nC·∫•u h√¨nh:\nFunction name: vpn-diagnostic-handler (ho·∫∑c t√™n b·∫°n ch·ªçn) Runtime: Python 3.11 (ho·∫∑c 3.9) Permissions: Use an existing role ‚Üí ch·ªçn lambda-vpn-diagnostic-role (role ƒë√£ t·∫°o ·ªü ph·∫ßn C) Click Create function.\nC·∫•u h√¨nh Environment variables V√†o function ‚Üí tab Configuration ‚Üí Environment variables ‚Üí Edit ‚Üí Add environment variables:\nVPN_ID = vpn-xxxxxxxx EC2_INSTANCE_ID = i-0123456789abcdef0 ONPREM_PRIVATE_IP = 192.168.100.10 REGION = ap-southeast-1 (ho·∫∑c region c·ªßa b·∫°n) FORWARD_SNS_ARN = `` (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng forward) Save.\nL∆∞u √Ω: kh√¥ng l∆∞u Pre-shared Key (PSK) v√†o bi·∫øn m√¥i tr∆∞·ªùng. N·∫øu c·∫ßn l∆∞u secret, d√πng AWS Secrets Manager v√† ƒë·ªçc trong Lambda.\nƒêi·ªÅu ch·ªânh timeout \u0026amp; memory V√†o Configuration ‚Üí General configuration ‚Üí Edit\nTimeout: ƒë·∫∑t 120 seconds (t√πy test, c√≥ th·ªÉ 180s) Memory: 256 MB Save. D√°n m√£ Lambda (full code) Trong tab Code -\u0026gt; Code source, ch·ªçn file lambda_function.py (ho·∫∑c inline editor) v√† d√°n ƒëo·∫°n code sau: import os import time import json import boto3 import logging logger = logging.getLogger() logger.setLevel(logging.INFO) ssm = boto3.client(\u0026#39;ssm\u0026#39;) ec2 = boto3.client(\u0026#39;ec2\u0026#39;) sns = boto3.client(\u0026#39;sns\u0026#39;) # Read env VPN_ID = os.environ.get(\u0026#39;VPN_ID\u0026#39;) EC2_INSTANCE_ID = os.environ.get(\u0026#39;EC2_INSTANCE_ID\u0026#39;) ONPREM_PRIVATE_IP = os.environ.get(\u0026#39;ONPREM_PRIVATE_IP\u0026#39;) REGION = os.environ.get(\u0026#39;REGION\u0026#39;) or boto3.session.Session().region_name FORWARD_SNS_ARN = os.environ.get(\u0026#39;FORWARD_SNS_ARN\u0026#39;) # optional def run_ssm_command(instance_id, commands, timeout=60): resp = ssm.send_command( InstanceIds=[instance_id], DocumentName=\u0026#34;AWS-RunShellScript\u0026#34;, Parameters={\u0026#34;commands\u0026#34;: commands}, TimeoutSeconds=timeout ) cmd_id = resp[\u0026#39;Command\u0026#39;][\u0026#39;CommandId\u0026#39;] logger.info(f\u0026#34;SSM command sent: CommandId={cmd_id}\u0026#34;) end_time = time.time() + timeout while time.time() \u0026lt; end_time: try: inv = ssm.get_command_invocation(CommandId=cmd_id, InstanceId=instance_id) status = inv.get(\u0026#39;Status\u0026#39;) logger.info(f\u0026#34;Invocation status: {status}\u0026#34;) if status in (\u0026#39;Success\u0026#39;, \u0026#39;Failed\u0026#39;, \u0026#39;Cancelled\u0026#39;, \u0026#39;TimedOut\u0026#39;): return inv except ssm.exceptions.InvocationDoesNotExist: pass time.sleep(1) raise TimeoutError(\u0026#34;SSM command invocation timed out\u0026#34;) def describe_vpn(vpn_id): resp = ec2.describe_vpn_connections(VpnConnectionIds=[vpn_id]) return resp.get(\u0026#39;VpnConnections\u0026#39;, []) def build_response_summary(event, vpn_info, ssm_result): summary = { \u0026#34;event\u0026#34;: event if isinstance(event, dict) else str(event), \u0026#34;vpn_info\u0026#34;: vpn_info, \u0026#34;ssm_result\u0026#34;: { \u0026#34;Status\u0026#34;: ssm_result.get(\u0026#39;Status\u0026#39;) if isinstance(ssm_result, dict) else ssm_result, \u0026#34;StandardOutputContent\u0026#34;: ssm_result.get(\u0026#39;StandardOutputContent\u0026#39;) if isinstance(ssm_result, dict) else None, \u0026#34;StandardErrorContent\u0026#34;: ssm_result.get(\u0026#39;StandardErrorContent\u0026#39;) if isinstance(ssm_result, dict) else None } } return summary def lambda_handler(event, context): logger.info(\u0026#34;Received event: %s\u0026#34;, json.dumps(event)) try: alarm_name = event.get(\u0026#39;detail\u0026#39;, {}).get(\u0026#39;alarmName\u0026#39;) or event.get(\u0026#39;AlarmName\u0026#39;) except Exception: alarm_name = None logger.info(f\u0026#34;Alarm name: {alarm_name}\u0026#34;) vpn_info = [] try: if VPN_ID: vpn_info = describe_vpn(VPN_ID) else: vpn_info = {\u0026#34;error\u0026#34;: \u0026#34;VPN_ID not set in environment\u0026#34;} except Exception as e: logger.exception(\u0026#34;Error describing VPN: %s\u0026#34;, e) vpn_info = {\u0026#34;error\u0026#34;: str(e)} ssm_result = {} if EC2_INSTANCE_ID and ONPREM_PRIVATE_IP: commands = [ f\u0026#34;echo \u0026#39;==== ping to {ONPREM_PRIVATE_IP} ====\u0026#39;\u0026#34;, f\u0026#34;ping -c 10 {ONPREM_PRIVATE_IP} || true\u0026#34;, f\u0026#34;echo \u0026#39;==== traceroute to {ONPREM_PRIVATE_IP} ====\u0026#39;\u0026#34;, f\u0026#34;traceroute -n {ONPREM_PRIVATE_IP} || true\u0026#34; ] try: inv = run_ssm_command(EC2_INSTANCE_ID, commands, timeout=120) ssm_result = { \u0026#34;Status\u0026#34;: inv.get(\u0026#39;Status\u0026#39;), \u0026#34;StandardOutputContent\u0026#34;: inv.get(\u0026#39;StandardOutputContent\u0026#39;), \u0026#34;StandardErrorContent\u0026#34;: inv.get(\u0026#39;StandardErrorContent\u0026#39;) } except Exception as e: logger.exception(\u0026#34;SSM command failed: %s\u0026#34;, e) ssm_result = {\u0026#34;error\u0026#34;: str(e)} else: ssm_result = {\u0026#34;error\u0026#34;: \u0026#34;EC2_INSTANCE_ID or ONPREM_PRIVATE_IP not configured\u0026#34;} summary = build_response_summary(alarm_name or event, vpn_info, ssm_result) logger.info(\u0026#34;Diagnostic summary: %s\u0026#34;, json.dumps(summary)) if FORWARD_SNS_ARN: try: sns.publish(TopicArn=FORWARD_SNS_ARN, Message=json.dumps(summary), Subject=f\u0026#34;VPN Diagnostic: {alarm_name}\u0026#34;) except Exception as e: logger.exception(\u0026#34;Failed to publish SNS: %s\u0026#34;, e) return { \u0026#34;statusCode\u0026#34;: 200, \u0026#34;body\u0026#34;: summary } Click Deploy (n·∫øu c·∫ßn). L∆∞u √Ω: ki·ªÉm tra script ch·∫°y ƒë∆∞·ª£c b·∫±ng c√°ch test Lambda (xem m·ª•c Testing b√™n d∆∞·ªõi). N·∫øu EC2 kh√¥ng c√≥ traceroute, c√¢n nh·∫Øc thay b·∫±ng tracepath ho·∫∑c c√†i package traceroute.\nT·∫°o EventBridge Rule (b·∫Øt CloudWatch Alarm ‚Üí g·ªçi Lambda) Thay v√¨ d√πng SNS, ta d√πng EventBridge ƒë·ªÉ b·∫Øt s·ª± ki·ªán Alarm state change v√† invoke Lambda.\nT·∫°o Rule M·ªü AWS Console ‚Üí Amazon EventBridge ‚Üí Rules ‚Üí Create rule.\nC·∫•u h√¨nh:\nName: alarm-vpn-tunnel1-to-lambda Description: Forward CloudWatch alarm vpn-tunnel1-down to lambda diagnostic Rule type: Event pattern ‚Üí ch·ªçn Custom pattern (JSON). D√°n event pattern sau (thay vpn-tunnel1-down b·∫±ng t√™n alarm c·ªßa b·∫°n n·∫øu kh√°c):\n{ \u0026#34;source\u0026#34;: [\u0026#34;aws.cloudwatch\u0026#34;], \u0026#34;detail-type\u0026#34;: [\u0026#34;CloudWatch Alarm State Change\u0026#34;], \u0026#34;detail\u0026#34;: { \u0026#34;alarmName\u0026#34;: [\u0026#34;vpn-tunnel1-down\u0026#34;], \u0026#34;state\u0026#34;: { \u0026#34;value\u0026#34;: [\u0026#34;ALARM\u0026#34;] } } } Select targets ‚Üí Target type: Lambda function ‚Üí ch·ªçn vpn-diagnostic-handler. Click Create. Khi b·∫°n ch·ªçn Lambda l√†m target, EventBridge s·∫Ω t·ª± ƒë·ªông th√™m permission resource-based policy cho Lambda ƒë·ªÉ EventBridge c√≥ th·ªÉ invoke function. N·∫øu kh√¥ng th·∫•y permission, xem ph·∫ßn troubleshooting.\n"
},
{
	"uri": "//localhost:1313/vi/3-create-site-to-site-vpn/3-2-configure-vpn/3-2-1-create-vpg/",
	"title": "T·∫°o Virtual Private Gateway",
	"tags": [],
	"description": "",
	"content": "T·∫°o Virtual Private Gateway (VGW) ‚ÑπÔ∏è T·ªïng quan\nVirtual Private Gateway (VGW) l√† th√†nh ph·∫ßn quan tr·ªçng cho k·∫øt n·ªëi Site-to-Site VPN ƒê√≥ng vai tr√≤ l√† ƒëi·ªÉm cu·ªëi VPN ph√≠a AWS C·∫ßn ƒë∆∞·ª£c g·∫Øn (attach) v√†o VPC ƒë√≠ch ƒë·ªÉ thi·∫øt l·∫≠p k·∫øt n·ªëi C√°c b∆∞·ªõc th·ª±c hi·ªán Truy c·∫≠p AWS VPC Console ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn Virtual Private Gateways Click Create Virtual Private Gateway C·∫•u h√¨nh Virtual Private Gateway Name tag: Nh·∫≠p VPN Gateway ASN: Ch·ªçn Amazon default ASN Click Create virtual private gateway üí° Pro Tip\nS·ª≠ d·ª•ng Amazon default ASN l√† l·ª±a ch·ªçn ph√π h·ª£p cho h·∫ßu h·∫øt tr∆∞·ªùng h·ª£p Custom ASN ch·ªâ c·∫ßn thi·∫øt khi c√≥ y√™u c·∫ßu ƒë·∫∑c bi·ªát v·ªÅ BGP routing G·∫Øn VGW v√†o VPC Ch·ªçn Actions Click Attach to VPC Ch·ªçn VPC ƒë√≠ch Trong dropdown, ch·ªçn VPC ASG Click Attach to VPC ‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng\nƒê·∫£m b·∫£o VGW chuy·ªÉn sang tr·∫°ng th√°i Attached tr∆∞·ªõc khi ti·∫øp t·ª•c Qu√° tr√¨nh attach c√≥ th·ªÉ m·∫•t v√†i ph√∫t ƒë·ªÉ ho√†n t·∫•t\nX√°c nh·∫≠n tr·∫°ng th√°i Ki·ªÉm tra State hi·ªÉn th·ªã l√† Attached VGW ƒë√£ s·∫µn s√†ng cho c·∫•u h√¨nh VPN ti·∫øp theo "
},
{
	"uri": "//localhost:1313/vi/2-preparation-step/2-1-create-vpc/",
	"title": "T·∫°o VPC",
	"tags": [],
	"description": "",
	"content": "T·∫°o Amazon Virtual Private Cloud (VPC) üîí C√°c b∆∞·ªõc th·ª±c hi·ªán\nTruy c·∫≠p AWS Management Console T√¨m ki·∫øm d·ªãch v·ª• VPC Ch·ªçn VPC t·ª´ k·∫øt qu·∫£ t√¨m ki·∫øm Trong giao di·ªán VPC Dashboard Ch·ªçn Your VPCs t·ª´ menu b√™n tr√°i Click v√†o Create VPC C·∫•u h√¨nh th√¥ng s·ªë VPC Resources: Ch·ªçn VPC only Name tag: Nh·∫≠p ASG IPv4 CIDR: Nh·∫≠p 10.10.0.0/16 ‚ö†Ô∏è L∆∞u √Ω v·ªÅ Tenancy Gi·ªØ t√πy ch·ªçn Tenancy ·ªü ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh (Default). Vi·ªác chuy·ªÉn sang Dedicated c√≥ th·ªÉ gi·ªõi h·∫°n c√°c lo·∫°i EC2 Instance ƒë∆∞·ª£c h·ªó tr·ª£ trong VPC.\nX√°c nh·∫≠n t·∫°o VPC Click Create VPC ƒë·ªÉ ho√†n t·∫•t qu√° tr√¨nh Ki·ªÉm tra tr·∫°ng th√°i VPC sau khi t·∫°o üí° C·∫•u h√¨nh DNS 6. K√≠ch ho·∫°t t√≠nh nƒÉng DNS cho VPC\nCh·ªçn Edit VPC settings M·ªü tab DNS settings B·∫≠t DNS hostnames v√† DNS resolution L∆∞u thay ƒë·ªïi "
},
{
	"uri": "//localhost:1313/vi/3-create-site-to-site-vpn/3-1-create-vpc-for-vpn/",
	"title": "T·∫°o VPC cho VPN",
	"tags": [],
	"description": "",
	"content": "Thi·∫øt l·∫≠p VPC cho Site-to-Site VPN ‚ö†Ô∏è Y√™u c·∫ßu ti√™n quy·∫øt\nQuy·ªÅn truy c·∫≠p v√†o AWS Console v·ªõi ƒë·ªß quy·ªÅn t·∫°o VPC resources Hi·ªÉu bi·∫øt c∆° b·∫£n v·ªÅ CIDR v√† subnet planning T·∫°o VPC v√† Subnet Truy c·∫≠p VPC Dashboard Ch·ªçn Your VPCs Click Create VPC C·∫•u h√¨nh VPC m·ªõi Resource type: Ch·ªçn VPC only Name: Nh·∫≠p ASG VPN IPv4 CIDR: Nh·∫≠p 10.11.0.0/16 Click Create VPC T·∫°o Public Subnet Truy c·∫≠p Subnets Click Create subnet Ch·ªçn VPC ASG VPN C·∫•u h√¨nh Subnet Name: Nh·∫≠p VPN Public Availability Zone: Ch·ªçn ap-southeast-1a IPv4 CIDR: Nh·∫≠p 10.11.1.0/24 Click Create subnet C·∫•u h√¨nh Internet Connectivity Enable Auto-assign Public IP Ch·ªçn subnet VPN Public Click Actions \u0026gt; Edit subnet settings Ch·ªçn Enable auto-assign public IPv4 address Click Save T·∫°o Internet Gateway Truy c·∫≠p Internet Gateways Click Create internet gateway Name: Nh·∫≠p Internet Gateway VPN Click Create Attach Internet Gateway v√†o VPC Ch·ªçn IGW v·ª´a t·∫°o Click Actions \u0026gt; Attach to VPC Ch·ªçn VPC ASG VPN Click Attach C·∫•u h√¨nh Route Table T·∫°o Route Table m·ªõi Truy c·∫≠p Route Tables Click Create route table Name: Nh·∫≠p Route table VPN - Public VPC: Ch·ªçn ASG VPN Click Create Th√™m Route cho Internet Access Ch·ªçn tab Routes Click Edit routes Click Add route Destination: Nh·∫≠p 0.0.0.0/0 Target: Ch·ªçn Internet Gateway VPN Click Save changes Li√™n k·∫øt Subnet Ch·ªçn tab Subnet associations Click Edit subnet associations Ch·ªçn subnet VPN Public Click Save associations üí° Pro Tip\nƒê·∫£m b·∫£o ki·ªÉm tra l·∫°i t·∫•t c·∫£ c√°c c·∫•u h√¨nh route v√† security group S·ª≠ d·ª•ng tags ƒë·ªÉ qu·∫£n l√Ω t√†i nguy√™n hi·ªáu qu·∫£ L∆∞u tr·ªØ CIDR ranges trong t√†i li·ªáu ƒë·ªÉ tham kh·∫£o sau n√†y "
},
{
	"uri": "//localhost:1313/vi/",
	"title": "T·ªïng quan",
	"tags": [],
	"description": "",
	"content": "T·ªîNG QUAN Site-to-Site VPN v·ªõi BGP v√† Redundancy l√† gi·∫£i ph√°p k·∫øt n·ªëi an to√†n, linh ho·∫°t v√† c√≥ kh·∫£ nƒÉng ch·ªãu l·ªói cao gi·ªØa h·∫° t·∫ßng AWS v√† h·ªá th·ªëng on-premises (ho·∫∑c gi·ªØa hai h·∫° t·∫ßng cloud kh√°c nhau). Gi·∫£i ph√°p n√†y t·∫≠n d·ª•ng s·ª©c m·∫°nh c·ªßa IPSec VPN, Border Gateway Protocol (BGP) v√† c∆° ch·∫ø redundancy ƒë·ªÉ ƒë·∫£m b·∫£o k·∫øt n·ªëi lu√¥n ho·∫°t ƒë·ªông li√™n t·ª•c ngay c·∫£ khi m·ªôt ƒë∆∞·ªùng truy·ªÅn g·∫∑p s·ª± c·ªë.\nGi·∫£i ph√°p ƒë∆∞·ª£c thi·∫øt k·∫ø d·ª±a tr√™n c√°c th√†nh ph·∫ßn ch√≠nh:\nAWS Virtual Private Gateway (VGW) ho·∫∑c AWS Transit Gateway (TGW): L√† ƒë·∫ßu m·ªëi k·∫øt n·ªëi ph√≠a AWS, ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω c√°c k·∫øt n·ªëi VPN v√† ƒë·ªãnh tuy·∫øn. Customer Gateway (CGW): Thi·∫øt b·ªã ho·∫∑c ph·∫ßn m·ªÅm ·ªü ph√≠a on-premises, ƒë√≥ng vai tr√≤ ƒë·ªëi t√°c k·∫øt n·ªëi. IPSec Tunnels: Hai ƒë∆∞·ªùng h·∫ßm b·∫£o m·∫≠t cho m·ªói k·∫øt n·ªëi VPN, ho·∫°t ƒë·ªông song song nh·∫±m cung c·∫•p kh·∫£ nƒÉng d·ª± ph√≤ng. BGP: Giao th·ª©c ƒë·ªãnh tuy·∫øn ƒë·ªông gi√∫p t·ª± ƒë·ªông c·∫≠p nh·∫≠t b·∫£ng ƒë·ªãnh tuy·∫øn, gi·∫£m thi·ªÉu downtime khi x·∫£y ra s·ª± c·ªë. Redundancy \u0026amp; Failover: C∆° ch·∫ø ph√¢n lu·ªìng v√† chuy·ªÉn h∆∞·ªõng l∆∞u l∆∞·ª£ng t·ª± ƒë·ªông khi m·ªôt tunnel ho·∫∑c ƒë∆∞·ªùng truy·ªÅn b·ªã l·ªói. L·ª£i √≠ch n·ªïi b·∫≠t c·ªßa gi·∫£i ph√°p:\nüîí B·∫£o m·∫≠t cao: S·ª≠ d·ª•ng IPSec ƒë·ªÉ m√£ h√≥a d·ªØ li·ªáu, ƒë·∫£m b·∫£o an to√†n trong qu√° tr√¨nh truy·ªÅn t·∫£i. ‚ö° T·ª± ƒë·ªông c·∫≠p nh·∫≠t ƒë·ªãnh tuy·∫øn: Nh·ªù BGP, vi·ªác th√™m, g·ª° b·ªè ho·∫∑c thay ƒë·ªïi m·∫°ng ƒë·ªÅu ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª± ƒë·ªông. üîÑ D·ª± ph√≤ng linh ho·∫°t: V·ªõi hai tunnel cho m·ªói k·∫øt n·ªëi v√† c√≥ th·ªÉ tri·ªÉn khai nhi·ªÅu k·∫øt n·ªëi VPN song song, h·ªá th·ªëng lu√¥n duy tr√¨ k·∫øt n·ªëi ·ªïn ƒë·ªãnh. üìà Kh·∫£ nƒÉng m·ªü r·ªông: D·ªÖ d√†ng k·∫øt n·ªëi th√™m site m·ªõi ho·∫∑c m·ªü r·ªông d·∫£i m·∫°ng m√† kh√¥ng ph·∫£i thay ƒë·ªïi th·ªß c√¥ng nhi·ªÅu c·∫•u h√¨nh. üí∞ T·ªëi ∆∞u chi ph√≠: Tr√°nh ph·ª• thu·ªôc ho√†n to√†n v√†o c√°c ƒë∆∞·ªùng truy·ªÅn leased-line ƒë·∫Øt ƒë·ªè, t·∫≠n d·ª•ng h·∫° t·∫ßng internet s·∫µn c√≥. K·ªãch b·∫£n tri·ªÉn khai ƒëi·ªÉn h√¨nh:\nK·∫øt n·ªëi AWS VPC v·ªõi trung t√¢m d·ªØ li·ªáu on-premises ph·ª•c v·ª• h·ªá th·ªëng ERP, CRM. ƒê·ªìng b·ªô d·ªØ li·ªáu th·ªùi gian th·ª±c gi·ªØa c√°c c∆° s·ªü h·∫° t·∫ßng. H·ªó tr·ª£ m√¥ h√¨nh Hybrid Cloud ho·∫∑c Multi-Cloud. T√≠ch h·ª£p gi·∫£i ph√°p DR (Disaster Recovery) v·ªõi kh·∫£ nƒÉng chuy·ªÉn m·∫°ch t·ª± ƒë·ªông. Trong workshop n√†y, ch√∫ng ta s·∫Ω ƒëi qua to√†n b·ªô quy tr√¨nh thi·∫øt k·∫ø, tri·ªÉn khai, ki·ªÉm th·ª≠ v√† gi√°m s√°t gi·∫£i ph√°p Site-to-Site VPN v·ªõi BGP v√† Redundancy, bao g·ªìm:\nThi·∫øt k·∫ø ki·∫øn tr√∫c highly available C·∫•u h√¨nh BGP Routing Tri·ªÉn khai multiple tunnels Thi·∫øt l·∫≠p automatic failover T√≠ch h·ª£p monitoring \u0026amp; troubleshooting Th·ª±c hi·ªán cost optimization Ki·ªÉm tra security compliance X√¢y d·ª±ng operational runbook \u0026amp; documentation "
},
{
	"uri": "//localhost:1313/vi/2-preparation-step/",
	"title": "C√°c b∆∞·ªõc chu·∫©n b·ªã",
	"tags": [],
	"description": "",
	"content": "T·ªïng quan v·ªÅ M√¥i tr∆∞·ªùng AWS VPC ‚ÑπÔ∏è M·ª•c ti√™u Lab\nX√¢y d·ª±ng m√¥i tr∆∞·ªùng VPC ho√†n ch·ªânh t·ª´ ƒë·∫ßu Tri·ªÉn khai c√°c th√†nh ph·∫ßn m·∫°ng c∆° b·∫£n c·ªßa AWS Thi·∫øt l·∫≠p c·∫•u tr√∫c m·∫°ng an to√†n v√† c√≥ kh·∫£ nƒÉng m·ªü r·ªông ‚ö†Ô∏è Ki·∫øn tr√∫c T·ªïng th·ªÉ Trong b√†i th·ª±c h√†nh n√†y, ch√∫ng ta s·∫Ω x√¢y d·ª±ng m·ªôt m√¥ h√¨nh VPC theo s∆° ƒë·ªì b√™n d∆∞·ªõi:\nüîí C√°c Th√†nh ph·∫ßn Ch√≠nh\nVPC - M√¥i tr∆∞·ªùng m·∫°ng ·∫£o ri√™ng bi·ªát Subnet - Ph√¢n ƒëo·∫°n m·∫°ng cho c√°c t√†i nguy√™n Internet Gateway - C·ªïng k·∫øt n·ªëi internet Route Table - B·∫£ng ƒë·ªãnh tuy·∫øn l∆∞u l∆∞·ª£ng m·∫°ng C√°c B∆∞·ªõc Tri·ªÉn khai üí° Quy tr√¨nh Th·ª±c hi·ªán\nT·∫°o VPC T·∫°o Subnet T·∫°o Internet Gateway T·∫°o Route Table "
},
{
	"uri": "//localhost:1313/vi/3-create-site-to-site-vpn/3-2-configure-vpn/",
	"title": "C·∫•u h√¨nh k·∫øt n·ªëi VPN",
	"tags": [],
	"description": "",
	"content": "C·∫•u h√¨nh AWS Site-to-Site VPN ‚ÑπÔ∏è T·ªïng quan\nPh·∫ßn n√†y h∆∞·ªõng d·∫´n thi·∫øt l·∫≠p k·∫øt n·ªëi AWS Site-to-Site VPN. Bao g·ªìm c·∫•u h√¨nh Virtual Private Gateway (VGW) v√† Customer Gateway (CGW). Cho ph√©p k·∫øt n·ªëi b·∫£o m·∫≠t gi·ªØa hai VPC th√¥ng qua IPSec tunnels. üîí Th√†nh ph·∫ßn ch√≠nh\nVirtual Private Gateway (VGW): ƒêi·ªÉm cu·ªëi VPN ph√≠a AWS. Customer Gateway (CGW): ƒê·∫°i di·ªán cho thi·∫øt b·ªã VPN ph√≠a kh√°ch h√†ng. VPN Connection: K·∫øt n·ªëi IPSec gi·ªØa VGW v√† CGW. C√°c b∆∞·ªõc tri·ªÉn khai üí° Quy tr√¨nh c·∫•u h√¨nh\nT·∫°o VPG T·∫°o Customer Gateway T·∫°o K·∫øt n·ªëi VPN "
},
{
	"uri": "//localhost:1313/vi/3-create-site-to-site-vpn/3-2-configure-vpn/3-2-2-create-customer-gateway/",
	"title": "T·∫°o Customer Gateway",
	"tags": [],
	"description": "",
	"content": "T·∫°o Customer Gateway Truy c·∫≠p v√†o VPC\nCh·ªçn Customer Gateways Ch·ªçn Create Customer Gateway Trong giao di·ªán Create Customer Gateway\nT·∫°i tr∆∞·ªùng Name tag, nh·∫≠p Customer Gateway T·∫°i tr∆∞·ªùng IP address, nh·∫≠p ƒë·ªãa ch·ªâ Public IP c·ªßa m√°y ch·ªß EC2 Customer Gateway Ch·ªçn Create Customer Gateway Qu√° tr√¨nh t·∫°o Customer Gateway s·∫Ω ho√†n t·∫•t sau kho·∫£ng 5 ph√∫t ‚ÑπÔ∏è Th√¥ng tin quan tr·ªçng: Theo m√¥ h√¨nh ki·∫øn tr√∫c, Customer Gateway s·∫Ω ƒë∆∞·ª£c tri·ªÉn khai trong VPC tr√™n m√¥i tr∆∞·ªùng on-premise. Trong b∆∞·ªõc n√†y, ch√∫ng ta ƒëang khai b√°o v·ªõi AWS v·ªÅ vi·ªác s·ª≠ d·ª•ng m·ªôt Customer Gateway v·ªõi ƒë·ªãa ch·ªâ IP public c·ªßa EC2 instance (Customer Gateway) n·∫±m trong Auto Scaling Group c·ªßa VPN VPC.\n"
},
{
	"uri": "//localhost:1313/vi/2-preparation-step/2-2-create-subnet/",
	"title": "T·∫°o Subnet",
	"tags": [],
	"description": "",
	"content": "T·∫°o Subnet trong Amazon VPC üîí C√°c b∆∞·ªõc th·ª±c hi·ªán\nTruy c·∫≠p giao di·ªán VPC Ch·ªçn Subnets t·ª´ menu b√™n tr√°i Click v√†o Create subnet Ch·ªçn VPC Trong giao di·ªán Create subnet Ch·ªçn VPC ASG ƒë√£ t·∫°o tr∆∞·ªõc ƒë√≥ C·∫•u h√¨nh Subnet ƒë·∫ßu ti√™n Subnet name: Nh·∫≠p Public Subnet 1 Availability Zone: Ch·ªçn ap-southeast-1a IPv4 CIDR: Nh·∫≠p 10.10.1.0/24 Click Create subnet X√°c nh·∫≠n t·∫°o subnet th√†nh c√¥ng üí° T·∫°o c√°c Subnet b·ªï sung\nL·∫∑p l·∫°i quy tr√¨nh ƒë·ªÉ t·∫°o th√™m c√°c subnet sau: Public Subnet 2 CIDR: 10.10.2.0/24 AZ: ap-southeast-1b Private Subnet 1 CIDR: 10.10.3.0/24 AZ: ap-southeast-1a Private Subnet 2 CIDR: 10.10.4.0/24 AZ: ap-southeast-1b ‚ö†Ô∏è L∆∞u √Ω v·ªÅ Availability Zone AWS s·ª≠ d·ª•ng hai kh√°i ni·ªám:\nAvailability Zone (AZ): T√™n hi·ªÉn th·ªã (v√≠ d·ª•: ap-southeast-1a) -** AZ ID**: ƒê·ªãnh danh th·ª±c t·∫ø c·ªßa AZ AWS √°nh x·∫° ng·∫´u nhi√™n AZ v·ªõi AZ ID gi·ªØa c√°c t√†i kho·∫£n ƒë·ªÉ ƒë·∫£m b·∫£o ph√¢n ph·ªëi t√†i nguy√™n ƒë·ªìng ƒë·ªÅu. C·∫•u h√¨nh Auto-assign Public IP ‚ÑπÔ∏è M·ª•c ƒë√≠ch Cho ph√©p t·ª± ƒë·ªông c·∫•p ph√°t ƒë·ªãa ch·ªâ IP c√¥ng c·ªông cho c√°c instance trong public subnet.\nC·∫•u h√¨nh** Public Subnet 1** Ch·ªçn subnet t·ª´ danh s√°ch Click Actions Ch·ªçn Edit subnet settings K√≠ch ho·∫°t t√≠nh nƒÉng Auto-assign IP B·∫≠t Enable auto-assign public IPv4 address Click Save L·∫∑p l·∫°i c·∫•u h√¨nh cho Public Subnet 2 "
},
{
	"uri": "//localhost:1313/vi/6-site-to-site-vpn-lambda-cloudwatch/6-2-testing-troubleshooting/",
	"title": "Testing &amp; Troubleshooting",
	"tags": [],
	"description": "",
	"content": "Testing / Ki·ªÉm th·ª≠ Test qua EventBridge (khuy·∫øn ngh·ªã):\nEventBridge ‚Üí Rules ‚Üí ch·ªçn rule alarm-vpn-tunnel1-to-lambda ‚Üí Test ‚Üí Create test event ‚Üí paste sample event JSON (m·∫´u c√≥ trong t√†i li·ªáu workshop) ‚Üí Send test event. Ki·ªÉm tra Lambda ‚Üí Monitoring ‚Üí View logs in CloudWatch. Test invoke tr·ª±c ti·∫øp Lambda:\nLambda ‚Üí ch·ªçn function ‚Üí Test ‚Üí paste {} ho·∫∑c sample event ‚Üí Run. End-to-end (th·ª±c t·∫ø):\nK√≠ch ho·∫°t alarm th·∫≠t (v√≠ d·ª• ch·∫∑n UDP 500/4500 outbound t·ªõi AWS_T1_OUT ƒë·ªÉ TunnelState = 0) ‚Üí khi Alarm chuy·ªÉn ALARM, EventBridge s·∫Ω invoke Lambda ‚Üí Lambda g·ªçi SSM ‚Üí check SSM command output. Troubleshooting quick guide (H∆∞·ªõng d·∫´n x·ª≠ l√Ω nhanh) B·∫£ng t√≥m t·∫Øt symptom ‚Üí nguy√™n nh√¢n c√≥ th·ªÉ ‚Üí l·ªánh/ki·ªÉm tra nhanh (console \u0026amp; on‚Äëprem). Sau b·∫£ng l√† h∆∞·ªõng d·∫´n chi ti·∫øt t·ª´ng b∆∞·ªõc.\nSymptom Possible causes Quick fixes / commands Tunnel DOWN (AWS) PSK mismatch, outside IP blocked, NAT-T blocked (UDP 4500/500) Check AWS Tunnel details; on‚Äëprem: show crypto isakmp sa / show crypto ipsec sa or sudo ipsec statusall BGP not established Wrong inside IP, ASN mismatch, TCP 179 blocked, BGP timers Verify inside IPs; verify ASN; show ip bgp summary on router; check security groups/NACL (though BGP is over inside IPs through VPN) Intermittent packet loss MTU/fragmentation, packet drop on path, IPSec rekey Check IPSec SA counters; reduce MTU; enable DF handling; run continuous ping/iperf Routes not propagated to VPC Route propagation disabled, BGP not advertising VPC ‚Üí Route Tables ‚Üí Route propagation enabled for VGW; AWS: aws ec2 describe-route-tables Troubleshooting (th∆∞·ªùng g·∫∑p) EventBridge kh√¥ng invoke Lambda: ki·ªÉm tra resource-based policy c·ªßa Lambda (Permissions ‚Üí Resource-based policy). N·∫øu c·∫ßn, th√™m b·∫±ng CLI:\naws lambda add-permission \\ --function-name vpn-diagnostic-handler \\ --statement-id eventbridge-invoke \\ --action \u0026#34;lambda:InvokeFunction\u0026#34; \\ --principal events.amazonaws.com \\ --source-arn arn:aws:events:\u0026lt;region\u0026gt;:\u0026lt;account-id\u0026gt;:rule/alarm-vpn-tunnel1-to-lambda SSM kh√¥ng th·ª±c thi l·ªánh: ki·ªÉm tra EC2 c√≥ SSM Agent \u0026amp; Instance Profile\n"
},
{
	"uri": "//localhost:1313/vi/6-site-to-site-vpn-lambda-cloudwatch/6-3-performance-monitroing-dashboard/",
	"title": "Performance monitoring &amp; Dashboard",
	"tags": [],
	"description": "",
	"content": "Performance monitoring \u0026amp; Dashboard (CloudWatch) Ph·∫ßn n√†y h∆∞·ªõng d·∫´n chi ti·∫øt c√°ch c·∫•u h√¨nh gi√°m s√°t hi·ªáu nƒÉng v√† tr·∫°ng th√°i Site‚Äëto‚ÄëSite VPN b·∫±ng Amazon CloudWatch, t·∫°o dashboard tr·ª±c quan v√† c·∫•u h√¨nh retention cho logs li√™n quan.\nMetrics c·∫ßn gi√°m s√°t (namespace AWS/VPN) C√°c metric c·ªët l√µi c·∫ßn theo d√µi:\nTunnelState (1 = up, 0 = down)\nD√πng ƒë·ªÉ ph√°t hi·ªán tunnel b·ªã down. TunnelDataIn / TunnelDataOut (bytes)\nL∆∞u l∆∞·ª£ng inbound/outbound qua m·ªói tunnel ‚Äî d√πng ƒë·ªÉ ph√°t hi·ªán spike ho·∫∑c traffic shift khi failover. TunnelPacketDrop / TunnelPacketLoss (n·∫øu provider cung c·∫•p)\nN·∫øu c√≥, d√πng ƒë·ªÉ ph√°t hi·ªán m·∫•t g√≥i/quality issues. TunnelLatency (n·∫øu provider cung c·∫•p)\nD√πng ƒë·ªÉ gi√°m s√°t ƒë·ªô tr·ªÖ gi·ªØa hai ƒë·∫ßu tunnel. Ghi ch√∫: metric c√≥ th·ªÉ xu·∫•t hi·ªán theo d·∫°ng per‚Äëtunnel (t√°ch theo tunnel index) ‚Äî khi ch·ªçn metric, h√£y l·ªçc theo VpnConnectionId v√† TunnelIndex ƒë·ªÉ ƒë·∫£m b·∫£o ƒë√∫ng tunnel.\nT·∫°o Dashboard chi ti·∫øt (CloudWatch) H∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc t·∫°o dashboard vpn-dashboard v√† th√™m widgets c·∫ßn thi·∫øt.\nT·∫°o dashboard M·ªü AWS Console ‚Üí CloudWatch ‚Üí Dashboards ‚Üí Create dashboard. ƒê·∫∑t t√™n: vpn-dashboard ‚Üí Create dashboard. Ch·ªçn layout (v√≠ d·ª•: Grid ho·∫∑c Time series) ‚Äî Grid linh ho·∫°t h∆°n ƒë·ªÉ th√™m nhi·ªÅu widget. Th√™m widget Line graph cho l∆∞u l∆∞·ª£ng Trong dashboard, click Add widget ‚Üí ch·ªçn Line (Line graph). Trong modal Add metric, ch·ªçn Browse ‚Üí AWS/VPN ‚Üí By Tunnel (ho·∫∑c By VPN Connection t√πy giao di·ªán). Ch·ªçn metric TunnelDataIn v√† TunnelDataOut cho c·∫£ hai tunnel (t·ª´ c√πng VPN connection) ‚Äî b·∫°n c√≥ th·ªÉ th√™m nhi·ªÅu series trong c√πng widget. ƒêi·ªÅu ch·ªânh: Statistic = Sum ho·∫∑c Average (th∆∞·ªùng d√πng Sum cho bytes), Period = 1 minute ho·∫∑c 5 minutes t√πy nhu c·∫ßu. Optionally, b·∫≠t Y axis (left/right) n·∫øu mu·ªën hi·ªÉn th·ªã hai metric v·ªõi scale kh√°c nhau. Click Create widget. Th√™m Single value widgets cho TunnelState Click Add widget ‚Üí ch·ªçn Single value. Ch·ªçn metric AWS/VPN ‚Üí TunnelState cho Tunnel 1 (l·ªçc theo VpnConnectionId v√† TunnelIndex=1). Statistic: Minimum ƒë·ªÉ n·∫øu gi√° tr·ªã c√≥ l√∫c 0 s·∫Ω hi·ªÉn th·ªã 0. Title: Tunnel 1 State ‚Üí Create widget. L·∫∑p l·∫°i cho Tunnel 2 (TunnelIndex=2) ƒë·ªÉ c√≥ 2 widget tr·∫°ng th√°i ri√™ng. Th√™m c·∫£nh b√°o tr·∫°ng th√°i \u0026amp; annotation B·∫°n c√≥ th·ªÉ th√™m annotations (text) ho·∫∑c widget Alarm status (n·∫øu mu·ªën hi·ªÉn th·ªã tr·∫°ng th√°i alarm tr√™n dashboard). Th√™m widget Text ƒë·ªÉ vi·∫øt runbook ng·∫Øn (v√≠ d·ª• c√°c b∆∞·ªõc x·ª≠ l√Ω nhanh khi tunnel down). Metric Math (t√πy ch·ªçn) ƒê·ªÉ xem t·ªïng l∆∞u l∆∞·ª£ng qua c·∫£ 2 tunnel, khi th√™m widget ch·ªçn Add math expression v√† d√πng expression nh∆∞: m1 + m2 (v·ªõi m1 = TunnelDataOut t1, m2 = TunnelDataOut t2). ƒê·∫∑t t√™n cho expression (v√≠ d·ª• TotalDataOut) ƒë·ªÉ d·ªÖ theo d√µi. T√πy ch·ªânh th·ªùi gian \u0026amp; refresh ·ªû g√≥c tr√™n dashboard, ch·ªçn time range (Last 1 hour / 3 hours / 24 hours) v√† Refresh interval (Auto / 1 minute / 5 minutes). L∆∞u \u0026amp; chia s·∫ª Click Save dashboard. B·∫°n c√≥ th·ªÉ export link (View in Console) ho·∫∑c b·∫≠t share theo IAM ƒë·ªÉ nh√≥m v·∫≠n h√†nh truy c·∫≠p. CloudWatch Logs retention (ƒë·∫∑t retention cho Lambda/SSM logs) ƒê·∫£m b·∫£o logs kh√¥ng l∆∞u gi·ªØ v√¥ h·∫°n ƒë·ªÉ tr√°nh chi ph√≠ tƒÉng.\nThi·∫øt l·∫≠p retention cho m·ªói Log Group M·ªü CloudWatch ‚Üí Logs ‚Üí Log groups. T√¨m log group c·ªßa Lambda: /aws/lambda/vpn-diagnostic-handler ‚Üí ch·ªçn log group. Click Actions ‚Üí Edit retention ‚Üí ch·ªçn 90 days (ho·∫∑c policy c·ªßa b·∫°n) ‚Üí Save. L·∫∑p l·∫°i cho log group Systems Manager (SSM) output n·∫øu c√≥ (v√≠ d·ª• /aws/ssm/commands ho·∫∑c t√™n custom b·∫°n d√πng). L∆∞u √Ω v·ªÅ logging volume Tr√°nh in qu√° nhi·ªÅu logs (verbose) trong Lambda khi ch·∫°y trong production. S·ª≠ d·ª•ng LOG_LEVEL ƒë·ªÉ ƒëi·ªÅu ch·ªânh. D√πng CloudWatch Logs Insights ƒë·ªÉ run queries thay v√¨ xu·∫•t to√†n b·ªô logs xu·ªëng S3. "
},
{
	"uri": "//localhost:1313/vi/2-preparation-step/2-3-create-internet-gateway/",
	"title": "T·∫°o Internet GateWay",
	"tags": [],
	"description": "",
	"content": "T·∫°o Internet Gateway trong Amazon VPC üîí C√°c b∆∞·ªõc th·ª±c hi·ªán\nTruy c·∫≠p giao di·ªán VPC Ch·ªçn Internet Gateways t·ª´ menu b√™n tr√°i Click v√†o Create internet gateway C·∫•u h√¨nh Internet Gateway T·∫°i Name tag, nh·∫≠p Internet Gateway Click Create internet gateway X√°c nh·∫≠n t·∫°o Internet Gateway th√†nh c√¥ng üí° K·∫øt n·ªëi v·ªõi VPC\nG·∫Øn Internet Gateway v√†o VPC Click Actions Ch·ªçn Attach to VPC Ch·ªçn VPC ASG t·ª´ danh s√°ch (VPC ID s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn) Click Attach internet gateway ‚ö†Ô∏è X√°c nh·∫≠n tr·∫°ng th√°i 5. Sau khi g·∫Øn th√†nh c√¥ng:\nState c·ªßa Internet Gateway s·∫Ω chuy·ªÉn sang Attached IGW ƒë√£ s·∫µn s√†ng ƒë·ªãnh tuy·∫øn l∆∞u l∆∞·ª£ng internet cho VPC "
},
{
	"uri": "//localhost:1313/vi/3-create-site-to-site-vpn/3-2-configure-vpn/3-2-3-create-vpn-connection/",
	"title": "T·∫°o k·∫øt n·ªëi t·ªõi VPN",
	"tags": [],
	"description": "",
	"content": "Thi·∫øt l·∫≠p AWS Site-to-Site VPN Connection T·∫°o VPN Connection Truy c·∫≠p AWS VPC Console ƒêi·ªÅu h∆∞·ªõng ƒë·∫øn Site-to-Site VPN Connections Click Create VPN Connection C·∫•u h√¨nh VPN Connection c∆° b·∫£n Name tag: Nh·∫≠p VPN Connection Target Gateway Type: Ch·ªçn Virtual Private Gateway Virtual Private Gateway: Ch·ªçn VPN Gateway ƒë√£ t·∫°o Customer Gateway: Ch·ªçn Existing Customer Gateway ID: Ch·ªçn Customer Gateway ƒë√£ t·∫°o C·∫•u h√¨nh Routing Routing Options: Ch·ªçn Dynamic Ph·∫£i ch·ªçn Dynamic v√¨ l√†m theo BGP, ch·ªçn Static s·∫Ω ph√π h·ª£p v·ªõi m√¥i tr∆∞·ªùng √≠t thay ƒë·ªïi nhi·ªÅu\nL∆∞u √Ω:\nGhi nh·ªõ ho·∫∑c ch·ª•p m√†n h√¨nh ho·∫∑c ch√©p c√°c th√¥ng tin v√† l∆∞u v√†o ƒë√¢u ƒë√≥ T·∫°i VPN -\u0026gt; VPN Details Kh·ªüi t·∫°o VPN Connection Review c·∫•u h√¨nh Click Create VPN Connection ‚ö†Ô∏è L∆∞u √Ω\nQu√° tr√¨nh kh·ªüi t·∫°o VPN c√≥ th·ªÉ m·∫•t 5-10 ph√∫t ƒê·ª£i tr·∫°ng th√°i chuy·ªÉn sang Available tr∆∞·ªõc khi ti·∫øp t·ª•c\nC·∫•u h√¨nh Route Propagation C·∫•u h√¨nh cho Public Route Table\nTruy c·∫≠p Route Tables trong VPC Console Ch·ªçn route table c·ªßa Public subnet Ch·ªçn tab Route Propagation Click **Edit route propagation ** Enable Route Propagation\nCh·ªçn Enable cho Virtual Private Gateway Click Save X√°c nh·∫≠n tr·∫°ng th√°i Ki·ªÉm tra Route Propagation ƒë√£ chuy·ªÉn sang Yes L·∫∑p l·∫°i quy tr√¨nh cho Private Route Table Th·ª±c hi·ªán t∆∞∆°ng t·ª± c√°c b∆∞·ªõc tr√™n ƒê·∫£m b·∫£o route propagation ƒë∆∞·ª£c enable cho c·∫£ public v√† private subnets üîí Security Note\nRoute propagation t·ª± ƒë·ªông c·∫≠p nh·∫≠t b·∫£ng ƒë·ªãnh tuy·∫øn khi c√≥ thay ƒë·ªïi ƒê·∫£m b·∫£o ch·ªâ enable cho c√°c route tables c·∫ßn thi·∫øt ƒë·ªÉ tr√°nh r·ªßi ro b·∫£o m·∫≠t "
},
{
	"uri": "//localhost:1313/vi/3-create-site-to-site-vpn/",
	"title": "T·∫°o Site-to-Site-VPN",
	"tags": [],
	"description": "",
	"content": "AWS Site-to-Site VPN ‚ÑπÔ∏è T·ªïng quan\nAWS Site-to-Site VPN cho ph√©p t·∫°o k·∫øt n·ªëi b·∫£o m·∫≠t gi·ªØa on-premises data center ho·∫∑c branch office network v√† Amazon VPC. H·ªó tr·ª£ c·∫£ hardware VPN appliances v√† software-based VPN solutions t√πy theo nhu c·∫ßu. S·ª≠ d·ª•ng IPSec tunnels ƒë·ªÉ m√£ h√≥a d·ªØ li·ªáu khi truy·ªÅn qua Internet. Y√™u c·∫ßu c·∫•u h√¨nh Virtual Private Gateway (VPG) ·ªü ph√≠a AWS v√† Customer Gateway (CGW) ·ªü ph√≠a kh√°ch h√†ng. Th√†nh ph·∫ßn ch√≠nh üîí Virtual Private Gateway (VPG)\nL√† VPN endpoint ƒë∆∞·ª£c tri·ªÉn khai trong AWS. K·∫øt n·ªëi tr·ª±c ti·∫øp v·ªõi VPC th√¥ng qua VPC attachments. Qu·∫£n l√Ω v√† ƒëi·ªÅu ph·ªëi c√°c k·∫øt n·ªëi VPN. H·ªó tr·ª£ c·∫£ dynamic routing (BGP) v√† static routing. M·ªói VPC ch·ªâ c√≥ th·ªÉ g·∫Øn m·ªôt VPG t·∫°i m·ªôt th·ªùi ƒëi·ªÉm. üîí Customer Gateway (CGW)\nƒê·∫°i di·ªán cho thi·∫øt b·ªã VPN ph√≠a kh√°ch h√†ng (on-premises). C√≥ th·ªÉ l√† thi·∫øt b·ªã ph·∫ßn c·ª©ng (Cisco, Juniper, Fortinet, etc.) ho·∫∑c ph·∫ßn m·ªÅm (StrongSwan, OpenVPN). Y√™u c·∫ßu m·ªôt ƒë·ªãa ch·ªâ IP public tƒ©nh duy nh·∫•t trong m·ªói region. Ph·∫£i khai b√°o ASN (Autonomous System Number) n·∫øu d√πng BGP. üîí Redundancy \u0026amp; BGP\nM·ªói k·∫øt n·ªëi VPN tr√™n AWS t·∫°o hai tunnel IPSec ƒë·ªôc l·∫≠p ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh d·ª± ph√≤ng. S·ª≠ d·ª•ng BGP ƒë·ªÉ trao ƒë·ªïi route ƒë·ªông gi·ªØa AWS v√† on-premises. Automatic Failover: Khi m·ªôt tunnel g·∫∑p s·ª± c·ªë, BGP s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t route v√† chuy·ªÉn l∆∞u l∆∞·ª£ng sang tunnel c√≤n l·∫°i m√† kh√¥ng gi√°n ƒëo·∫°n d·ªãch v·ª•. C√≥ th·ªÉ thi·∫øt l·∫≠p t·ªëi ∆∞u h√≥a ƒë·ªãnh tuy·∫øn b·∫±ng c√°ch c·∫•u h√¨nh BGP metrics v√† AS_PATH prepending ƒë·ªÉ ∆∞u ti√™n m·ªôt tunnel l√†m primary v√† tunnel c√≤n l·∫°i l√†m backup. üîí CloudWatch Alarm \u0026amp; Monitoring\nS·ª≠ d·ª•ng Amazon CloudWatch Metrics ƒë·ªÉ gi√°m s√°t tr·∫°ng th√°i VPN tunnels (TunnelState, TunnelDataIn, TunnelDataOut). T·∫°o CloudWatch Alarms ƒë·ªÉ c·∫£nh b√°o khi tunnel down. K·∫øt h·ª£p SNS (Simple Notification Service) ƒë·ªÉ g·ª≠i th√¥ng b√°o qua email/SMS. üîí Automation with Lambda\nS·ª≠ d·ª•ng AWS Lambda ƒë·ªÉ t·ª± ƒë·ªông h√≥a quy tr√¨nh failover ho·∫∑c x·ª≠ l√Ω s·ª± c·ªë. C√≥ th·ªÉ t√≠ch h·ª£p v·ªõi CloudWatch Events ƒë·ªÉ k√≠ch ho·∫°t Lambda khi tunnel b·ªã m·∫•t k·∫øt n·ªëi. T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh route trong VPC Route Tables ho·∫∑c c·∫≠p nh·∫≠t on-premises firewall rules khi c√≥ thay ƒë·ªïi. Quy tr√¨nh tri·ªÉn khai tr√™n AWS Management Console T·∫°o Virtual Private Gateway (VPG) v√† g·∫Øn v√†o VPC. T·∫°o Customer Gateway (CGW) v·ªõi IP public v√† ASN c·ªßa thi·∫øt b·ªã on-premises. T·∫°o Site-to-Site VPN Connection, ch·ªçn Dynamic (BGP) ho·∫∑c Static routing. T·∫£i file c·∫•u h√¨nh VPN t∆∞∆°ng th√≠ch v·ªõi thi·∫øt b·ªã (Cisco, Juniper, Fortinet, v.v.). C·∫•u h√¨nh thi·∫øt b·ªã VPN on-premises d·ª±a tr√™n file ƒë√£ t·∫£i. Ki·ªÉm tra tr·∫°ng th√°i tunnel trong AWS Console. C·∫•u h√¨nh CloudWatch Alarm v√† SNS ƒë·ªÉ gi√°m s√°t. Th·ª≠ nghi·ªám failover b·∫±ng c√°ch t·∫°m th·ªùi t·∫Øt m·ªôt tunnel v√† ki·ªÉm tra l∆∞u l∆∞·ª£ng. X√°c nh·∫≠n BGP routes ƒë√£ ƒë∆∞·ª£c trao ƒë·ªïi ƒë·∫ßy ƒë·ªß gi·ªØa hai ph√≠a. "
},
{
	"uri": "//localhost:1313/vi/6-site-to-site-vpn-lambda-cloudwatch/6-4-cost-optimization/",
	"title": "Cost optimization",
	"tags": [],
	"description": "",
	"content": "Cost optimization Ph·∫ßn n√†y h∆∞·ªõng d·∫´n c√°ch t·ªëi ∆∞u chi ph√≠ li√™n quan t·ªõi VPN, data transfer, CloudWatch v√† EC2 test machines.\nHi·ªÉu chi ph√≠ VPN VPN hourly: AWS t√≠nh ph√≠ theo connection-hour cho m·ªói Site-to-Site VPN connection (m·ªói connection c√≥ 2 tunnels).\nV√≠ d·ª• gi·∫£ ƒë·ªãnh: 0.05 USD/connection-hour. N·∫øu duy tr√¨ 1 k·∫øt n·ªëi trong 24 gi·ªù: 24 √ó 0.05 = 1.2 USD/ng√†y. N·∫øu th·ª≠ nghi·ªám 5 ng√†y/tu·∫ßn, 4 tu·∫ßn: 5 √ó 4 √ó 1.2 = 24 USD/th√°ng. T·ªëi ∆∞u: trong m√¥i tr∆∞·ªùng lab hay workshop, t·∫Øt VPN khi kh√¥ng c·∫ßn thi·∫øt ƒë·ªÉ ti·∫øt ki·ªám ~1 USD/ng√†y.\nData transfer: Data outbound (Internet) c√≥ th·ªÉ b·ªã t√≠nh ph√≠ theo GB (v√≠ d·ª• 0.09 USD/GB).\nV√≠ d·ª• chuy·ªÉn 50 GB d·ªØ li·ªáu: 50 √ó 0.09 = 4.5 USD. Kh√¥ng ƒë·ªÅ c·∫≠p gi√° c·ª• th·ªÉ ·ªü ƒë√¢y ‚Äî ki·ªÉm tra Billing / Cost Explorer ƒë·ªÉ bi·∫øt gi√° theo region v√† t√†i kho·∫£n.\nTheo d√µi Data Transfer b·∫±ng Cost Explorer V√†o Billing \u0026amp; Cost Management ‚Üí Cost Explorer ‚Üí Launch Cost Explorer. T·∫°o b√°o c√°o custom: Group by: Service ‚Üí l·ªçc Amazon VPC / AWS VPN / Data Transfer. Time range: Last 30 days. Add filter: Usage Type ch·ª©a DataTransfer-Out. L∆∞u b√°o c√°o ƒë·ªÉ theo d√µi h√†ng tu·∫ßn. T·ªëi ∆∞u CloudWatch v√† Logs Retention: ƒë·∫∑t retention h·ª£p l√Ω (v√≠ d·ª• 30‚Äì90 ng√†y) cho log groups quan tr·ªçng. Metric Filters: ch·ªâ t·∫°o c√°c filter th·∫≠t s·ª± c·∫ßn thi·∫øt ‚Äî m·ªói filter c√≥ th·ªÉ t√≠nh ph√≠ ingestion. Log verbosity: trong Lambda, d√πng INFO ho·∫∑c WARN cho production; ch·ªâ b·∫≠t DEBUG khi c·∫ßn ph√¢n t√≠ch. EC2 v√† chi ph√≠ lab D√πng instance nh·ªè nh∆∞ t2.micro (~0.0104 USD/gi·ªù) ho·∫∑c t3.small (~0.0208 USD/gi·ªù) cho VM gi·∫£ l·∫≠p router. V√≠ d·ª•: t2.micro ch·∫°y 24 h = 24 √ó 0.0104 ‚âà 0.25 USD/ng√†y. Trong production, c·∫ßn t√≠nh network throughput ‚Äî ch·ªçn instance c√≥ ENA/high throughput. T·∫Øt (stop) ho·∫∑c terminate EC2 test khi kh√¥ng s·ª≠ d·ª•ng. Budgets \u0026amp; Alerts AWS Budgets ‚Üí Create budget: Lo·∫°i budget: Cost budget ho·∫∑c Usage budget (Data Transfer GB). V√≠ d·ª•: ƒë·∫∑t threshold ·ªü 80% v√† 100% ‚Üí g·ª≠i c·∫£nh b√°o qua email/SNS. T·∫°o Cost Anomaly Detection ƒë·ªÉ c·∫£nh b√°o n·∫øu chi ph√≠ ph√°t sinh b·∫•t th∆∞·ªùng. Tagging \u0026amp; Chargeback Tag r√µ c√°c resource (VPN, EC2, VPC) theo d·ª± √°n ho·∫∑c team ‚Äî gi√∫p ph√¢n t√≠ch chi ph√≠ ƒë√∫ng nh√≥m. S·ª≠ d·ª•ng Tag Policy ƒë·ªÉ ƒë·∫£m b·∫£o t·∫•t c·∫£ resource m·ªõi ƒë·ªÅu ƒë∆∞·ª£c g·∫Øn tag b·∫Øt bu·ªôc (nh∆∞ Project, Owner, Environment). B·∫£ng minh h·ªça chi ph√≠ (gi·∫£ ƒë·ªãnh) Resource Usage Cost unit Estimated cost VPN connection 24 h √ó 1 conn 0.05 USD/connection-hour 1.2 USD/day EC2 (t2.micro) 24 h √ó 30 days ~0.0104 USD/hour ~7.5 USD/month Data transfer 50 GB outbound 0.09 USD/GB 4.5 USD CloudWatch logs retention reduce to 30 days lower log volume ‚Üí lower cost savings t√πy volume Metric filters limit filters ingestion cost savings ~0.03-0.1 USD/filter/day Total (lab scenario) VPN + EC2 + Data ~13.2 USD/month L∆∞u √Ω: ƒê√¢y l√† b·∫£ng v√≠ d·ª• gi·∫£ ƒë·ªãnh ƒë·ªÉ h√¨nh dung m·ª©c chi ph√≠ ti·ªÅm nƒÉng ‚Äî b·∫°n n√™n thay b·∫±ng s·ªë li·ªáu th·ª±c t·∫ø t·ª´ Cost Explorer v√† Billing Dashboard c·ªßa t√†i kho·∫£n b·∫°n.\n"
},
{
	"uri": "//localhost:1313/vi/4-redundancy-testing-failover/",
	"title": "Redundancy Testing &amp; Failover",
	"tags": [],
	"description": "",
	"content": "üéØ M·ª•c ti√™u Ki·ªÉm tra kh·∫£ nƒÉng d·ª± ph√≤ng (redundancy) v√† t·ª± ƒë·ªông chuy·ªÉn m·∫°ch (automatic failover) c·ªßa ki·∫øn tr√∫c Site-to-Site VPN s·ª≠ d·ª•ng BGP.\nƒê·∫£m b·∫£o r·∫±ng khi m·ªôt tunnel g·∫∑p s·ª± c·ªë, l∆∞u l∆∞·ª£ng s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ƒë·ªãnh tuy·∫øn qua tunnel c√≤n l·∫°i m√† kh√¥ng l√†m gi√°n ƒëo·∫°n d·ªãch v·ª•.\nüìö Gi·ªõi thi·ªáu l√Ω thuy·∫øt Trong c·∫•u h√¨nh Site-to-Site VPN v·ªõi BGP, AWS cung c·∫•p 2 IPsec tunnels ƒë·ªÉ tƒÉng t√≠nh s·∫µn s√†ng.\nBGP s·∫Ω t·ª± ƒë·ªông ph√°t hi·ªán khi m·ªôt tunnel m·∫•t k·∫øt n·ªëi v√† r√∫t route BGP t∆∞∆°ng ·ª©ng kh·ªèi b·∫£ng ƒë·ªãnh tuy·∫øn.\nL∆∞u l∆∞·ª£ng s·∫Ω ƒë∆∞·ª£c chuy·ªÉn sang tunnel c√≤n ho·∫°t ƒë·ªông.\nKi·ªÉm tra redundancy gi√∫p:\nX√°c nh·∫≠n BGP failover ho·∫°t ƒë·ªông ƒë√∫ng. ƒê·∫£m b·∫£o c√°c route ƒë·ªông (dynamic routes) ƒë∆∞·ª£c c·∫≠p nh·∫≠t k·ªãp th·ªùi. X√°c minh th·ªùi gian downtime th·ª±c t·∫ø khi s·ª± c·ªë x·∫£y ra. üõ† C√°c b∆∞·ªõc th·ª±c hi·ªán tr√™n AWS Management Console B∆∞·ªõc 1 ‚Äî X√°c minh tr·∫°ng th√°i ban ƒë·∫ßu M·ªü AWS Management Console ‚Üí v√†o VPC. Ch·ªçn Site-to-Site VPN Connections. Ch·ªçn VPN connection c·ªßa b·∫°n. Chuy·ªÉn sang tab Tunnel Details. X√°c nh·∫≠n c·∫£ Tunnel 1 v√† Tunnel 2 ƒëang ·ªü tr·∫°ng th√°i: Status: UP BGP Status: UP B∆∞·ªõc 2 ‚Äî Ki·ªÉm tra b·∫£ng ƒë·ªãnh tuy·∫øn (Routing Table) Trong VPC, v√†o Route Tables. Ch·ªçn b·∫£ng ƒë·ªãnh tuy·∫øn g·∫Øn v·ªõi VPC Subnet ƒëang th·ª≠ nghi·ªám. Xem tab Routes. X√°c nh·∫≠n c√°c route ƒëi ƒë·∫øn m·∫°ng on-premises ƒëang c√≥ Target l√†: vgw-xxxxxxxx ho·∫∑c tgw-xxxxxxxx (t√πy ki·∫øn tr√∫c) Ghi ch√∫ ASN, prefix, v√† next hop t·ª´ BGP routes. B∆∞·ªõc 3 ‚Äî M√¥ ph·ªèng s·ª± c·ªë tr√™n Tunnel 1 Thao t√°c n√†y th·ª±c hi·ªán ·ªü ph√≠a on-premises ho·∫∑c t·∫°m th·ªùi thay ƒë·ªïi c·∫•u h√¨nh ƒë·ªÉ ng·∫Øt Tunnel 1.\nC√°ch ph·ªï bi·∫øn:\nTr√™n thi·∫øt b·ªã on-prem: shutdown interface ho·∫∑c IPsec policy c·ªßa Tunnel 1. N·∫øu kh√¥ng can thi·ªáp ƒë∆∞·ª£c on-prem: s·ª≠ d·ª•ng AWS CLI/Console ƒë·ªÉ disable Tunnel 1 b·∫±ng c√°ch ch·ªânh l·∫°i Pre-shared Key sai t·∫°m th·ªùi (ch·ªâ ƒë·ªÉ test, sau ƒë√≥ revert). B∆∞·ªõc 4 ‚Äî Quan s√°t failover Trong tab Tunnel Details, xem tr·∫°ng th√°i c·ªßa Tunnel 1 chuy·ªÉn t·ª´ UP ‚Üí DOWN. Ki·ªÉm tra Tunnel 2 v·∫´n UP. Trong Route Tables, refresh v√† x√°c nh·∫≠n: Route BGP t∆∞∆°ng ·ª©ng Tunnel 1 ƒë√£ bi·∫øn m·∫•t. L∆∞u l∆∞·ª£ng ƒëang ƒëi qua Tunnel 2. Th·ª±c hi·ªán ping/traceroute t·ª´ EC2 trong VPC t·ªõi server on-prem ƒë·ªÉ x√°c nh·∫≠n k·∫øt n·ªëi kh√¥ng b·ªã gi√°n ƒëo·∫°n. B∆∞·ªõc 5 ‚Äî Kh√¥i ph·ª•c Tunnel 1 Kh√¥i ph·ª•c c·∫•u h√¨nh ch√≠nh x√°c cho Tunnel 1 tr√™n thi·∫øt b·ªã on-prem. Quan s√°t Tunnel 1 tr·ªü l·∫°i tr·∫°ng th√°i UP v√† BGP Established. X√°c nh·∫≠n l·∫°i r·∫±ng BGP ƒë√£ qu·∫£ng b√° route tr·ªü l·∫°i v√† c√≥ 2 ƒë∆∞·ªùng active. B∆∞·ªõc 6 ‚Äî Th·ª±c hi·ªán t∆∞∆°ng t·ª± cho Tunnel 2 L·∫∑p l·∫°i quy tr√¨nh v·ªõi Tunnel 2 ƒë·ªÉ ƒë·∫£m b·∫£o failover hai chi·ªÅu ho·∫°t ƒë·ªông ƒë√∫ng. üìà X√°c minh th·ªùi gian failover S·ª≠ d·ª•ng CloudWatch Metrics cho VPN connection: V√†o CloudWatch ‚Üí Metrics ‚Üí VPN. Theo d√µi metric TunnelState, BGPStatus, TunnelDataIn/Out. Ghi nh·∫≠n th·ªùi gian t·ª´ l√∫c tunnel down ƒë·∫øn khi l∆∞u l∆∞·ª£ng ƒëi qua tunnel c√≤n l·∫°i. üí∞ L∆∞u √Ω v·ªÅ chi ph√≠ Vi·ªác duy tr√¨ c·∫£ 2 tunnels ·ªü tr·∫°ng th√°i UP kh√¥ng ph√°t sinh th√™m chi ph√≠ VPN c·ªë ƒë·ªãnh, nh∆∞ng l∆∞u l∆∞·ª£ng qua tunnel v·∫´n t√≠nh ph√≠ Data Transfer. N·∫øu testing nhi·ªÅu, c√≥ th·ªÉ ph√°t sinh chi ph√≠ CloudWatch Logs/Alarms. üîí L∆∞u √Ω b·∫£o m·∫≠t Sau khi testing b·∫±ng c√°ch ƒë·ªïi Pre-shared Key ho·∫∑c t·∫Øt tunnel, ph·∫£i kh√¥i ph·ª•c l·∫°i ƒë√∫ng th√¥ng s·ªë ban ƒë·∫ßu. Ch·ªâ th·ª±c hi·ªán test trong khung gi·ªù b·∫£o tr√¨ ho·∫∑c khi c√≥ s·ª± ƒë·ªìng thu·∫≠n t·ª´ team v·∫≠n h√†nh. ‚úÖ K·∫øt qu·∫£ mong ƒë·ª£i:\nKhi m·ªôt tunnel b·ªã down, l∆∞u l∆∞·ª£ng s·∫Ω t·ª± ƒë·ªông chuy·ªÉn sang tunnel c√≤n l·∫°i. Th·ªùi gian downtime th·ª±c t·∫ø ch·ªâ b·∫±ng th·ªùi gian BGP detect + route propagation (th∆∞·ªùng 20‚Äì30 gi√¢y). "
},
{
	"uri": "//localhost:1313/vi/2-preparation-step/2-4-create-route-table/",
	"title": "T·∫°o Route Table",
	"tags": [],
	"description": "",
	"content": "T·∫†O ROUTE TABLE T·∫°o Route Table trong Amazon VPC üîí C√°c b∆∞·ªõc th·ª±c hi·ªán\nTruy c·∫≠p giao di·ªán VPC Ch·ªçn Route Tables t·ª´ menu b√™n tr√°i Click v√†o Create route table C·∫•u h√¨nh Route Table Name: Nh·∫≠p Route table-Public VPC: Ch·ªçn VPC ASG (VPC ID s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn) Click Create route table X√°c nh·∫≠n t·∫°o Route Table th√†nh c√¥ng üí° C·∫•u h√¨nh ƒë·ªãnh tuy·∫øn\nTh√™m route cho Internet Gateway Click Actions Ch·ªçn Edit routes C·∫•u h√¨nh route m·ªõi Click Add route Destination: Nh·∫≠p 0.0.0.0/0 (ƒë·∫°i di·ªán cho internet) Target: Ch·ªçn Internet Gateway v√† ch·ªçn IGW ƒë√£ t·∫°o Click Save changes ‚ö†Ô∏è Li√™n k·∫øt v·ªõi Subnet\nThi·∫øt l·∫≠p subnet associations Ch·ªçn tab Subnet associations Click Edit subnet associations Ch·ªçn c√°c public subnet M·ªü r·ªông c·ªôt Subnet ID ƒë·ªÉ xem chi ti·∫øt Ch·ªçn c·∫£ 2 public subnet ƒë√£ t·∫°o Click Save associations X√°c nh·∫≠n c·∫•u h√¨nh subnet associations th√†nh c√¥ng "
},
{
	"uri": "//localhost:1313/vi/6-site-to-site-vpn-lambda-cloudwatch/6-5-checkin-aws-console/",
	"title": "Ki·ªÉm tra ngay tr√™n AWS Management Console",
	"tags": [],
	"description": "",
	"content": "Ki·ªÉm tra tr·∫°ng th√°i Tunnel \u0026amp; BGP VPC Console ‚Üí Site-to-Site VPN Connections ‚Üí ch·ªçn VPN connection.\nM·ªü tab Tunnel Details:\nKi·ªÉm tra Status (UP/DOWN) cho Tunnel 1 \u0026amp; Tunnel 2. Ki·ªÉm tra BGP Status (Established / Idle). Sao ch√©p Outside IPs v√† Inside IPs ƒë·ªÉ so s√°nh v·ªõi config on‚Äëprem. Ki·ªÉm tra CloudWatch metrics CloudWatch ‚Üí Metrics ‚Üí All metrics ‚Üí AWS/VPN ‚Üí By Tunnel. Xem metric TunnelState ƒë·ªÉ x√°c ƒë·ªãnh th·ªùi ƒëi·ªÉm down. Xem TunnelDataIn/Out ƒë·ªÉ ph√°t hi·ªán spike ho·∫∑c chuy·ªÉn h∆∞·ªõng l∆∞u l∆∞·ª£ng. Ki·ªÉm tra Route propagation VPC ‚Üí Route Tables ‚Üí ch·ªçn route table c·ªßa subnet c·∫ßn reach on‚Äëprem. Tab Route propagation ‚Üí ƒë·∫£m b·∫£o VGW ƒë∆∞·ª£c b·∫≠t. Tab Routes ‚Üí x√°c nh·∫≠n route cho on‚Äëprem CIDR tr·ªè t·ªõi vgw-xxxx. Ki·ªÉm tra tr√™n thi·∫øt b·ªã On‚ÄëPremises (m·ªôt v√†i l·ªánh tham kh·∫£o) C√°c l·ªánh b√™n d∆∞·ªõi mang t√≠nh tham kh·∫£o; tu·ª≥ vendor (Cisco/Juniper/VyOS/pfSense) c√∫ ph√°p kh√°c nhau.\nKi·ªÉm tra ISAKMP / IKE SA Cisco IOS: show crypto isakmp sa show crypto ipsec sa VyOS / strongSwan: sudo ipsec statusall sudo swanctl --list-sas # n·∫øu d√πng swanctl Ki·ªÉm tra BGP Cisco: show ip bgp summary show ip bgp neighbors VyOS: show ip bgp summary Ki·ªÉm tra firewall / NAT Ki·ªÉm tra firewall rule c√≥ cho ph√©p UDP 500/4500, v√† kh√¥ng NAT outside IP (ho·∫∑c NAT ƒë√∫ng) D√πng tcpdump/wireshark ƒë·ªÉ b·∫Øt g√≥i tr√™n interface public: sudo tcpdump -n -i eth0 port 500 or port 4500 Ki·ªÉm tra MTU / Fragmentation Tr√™n on‚Äëprem, th·ª≠ ping v·ªõi DF flag v√† gi·∫£m MTU: ping -M do -s 1400 \u0026lt;ONPREM_PEER_IP\u0026gt; N·∫øu ping th√†nh c√¥ng v·ªõi size nh·ªè nh∆∞ng th·∫•t b·∫°i v·ªõi size l·ªõn, c√¢n nh·∫Øc gi·∫£m MTU ho·∫∑c enable MSS clamping tr√™n firewall. ‚ö†Ô∏è L∆∞u √Ω cu·ªëi c√πng\nTrong m·ªçi test, h√£y th·ª±c hi·ªán trong maintenance window ho·∫∑c th√¥ng b√°o t·ªõi teams li√™n quan. Kh√¥ng thay ƒë·ªïi c·∫£ hai tunnel c√πng l√∫c khi test failover. L∆∞u secrets (PSK, webhook) trong AWS Secrets Manager thay v√¨ ƒë·∫∑t tr·ª±c ti·∫øp trong Lambda env vars. "
},
{
	"uri": "//localhost:1313/vi/5-alarm-tunnelstate-cloudwatch/",
	"title": "T·∫°o Alarm gi√°m s√°t TunnelState trong AWS CloudWatch",
	"tags": [],
	"description": "",
	"content": "T·∫°o Alarm gi√°m s√°t TunnelState trong AWS CloudWatch M·ª•c ti√™u c·ªßa b∆∞·ªõc n√†y l√† c·∫•u h√¨nh gi√°m s√°t tr·∫°ng th√°i c·ªßa t·ª´ng VPN Tunnel b·∫±ng Amazon CloudWatch. Khi m·ªôt tunnel g·∫∑p s·ª± c·ªë (TunnelState = 0), h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông g·ª≠i c·∫£nh b√°o ƒë·ªÉ k·ªπ thu·∫≠t vi√™n c√≥ th·ªÉ th·ª±c hi·ªán failover ho·∫∑c kh·∫Øc ph·ª•c ngay.\nC√°c b∆∞·ªõc th·ª±c hi·ªán tr√™n AWS Management Console Truy c·∫≠p CloudWatch V√†o d·ªãch v·ª• CloudWatch tr√™n AWS Management Console. Trong menu b√™n tr√°i, ch·ªçn Metrics ‚Üí All metrics. Ch·ªçn metric TunnelState\nCh·ªçn namespace: AWS/VPN. Ch·ªçn ch·∫ø ƒë·ªô l·ªçc By Tunnel. T√¨m metric TunnelState cho tunnel b·∫°n mu·ªën gi√°m s√°t (v√≠ d·ª• Tunnel 1). Tick ch·ªçn metric n√†y. T·∫°o alarm\nNh·∫•n Actions (tr√™n c√πng b√™n ph·∫£i) ‚Üí Create alarm. C·∫•u h√¨nh ƒëi·ªÅu ki·ªán alarm Metric name: TunnelState Statistic: Minimum (ƒë·∫£m b·∫£o n·∫øu trong chu k·ª≥ c√≥ th·ªùi ƒëi·ªÉm TunnelState = 0 th√¨ v·∫´n k√≠ch ho·∫°t alarm). Period: 1 minute Threshold type: Static Whenever TunnelState is: Ch·ªçn Lower/Equal ‚Üí nh·∫≠p gi√° tr·ªã 0 C·∫•u h√¨nh h√†nh ƒë·ªông (Action) Alarm state trigger: In alarm Send notification to: Ch·ªçn SNS topic hi·ªán c√≥ ho·∫∑c t·∫°o m·ªõi. N·∫øu t·∫°o m·ªõi: Ch·ªçn Create new topic ƒê·∫∑t t√™n topic (v√≠ d·ª•: vpn-alerts) Nh·∫≠p ƒë·ªãa ch·ªâ email nh·∫≠n th√¥ng b√°o AWS s·∫Ω g·ª≠i email x√°c nh·∫≠n ‚Üí v√†o email v√† click x√°c nh·∫≠n ƒë·ªÉ k√≠ch ho·∫°t. ƒê·∫∑t t√™n v√† t·∫°o alarm Alarm name: v√≠ d·ª• VPN-Tunnel1-Down Description: ‚ÄúC·∫£nh b√°o khi VPN Tunnel 1 m·∫•t k·∫øt n·ªëi (TunnelState=0)‚Äù Nh·∫•n Create alarm ƒë·ªÉ ho√†n t·∫•t. L·∫∑p l·∫°i cho Tunnel 2 Quay l·∫°i All metrics ‚Üí AWS/VPN ‚Üí By Tunnel v√† t√¨m metric TunnelState c·ªßa Tunnel 2. T·∫°o alarm t∆∞∆°ng t·ª± ƒë·ªÉ ƒë·∫£m b·∫£o c·∫£ 2 tunnel ƒë·ªÅu ƒë∆∞·ª£c gi√°m s√°t. K·∫øt qu·∫£ mong ƒë·ª£i Khi m·ªôt tunnel b·ªã m·∫•t k·∫øt n·ªëi, gi√° tr·ªã TunnelState s·∫Ω chuy·ªÉn sang 0. CloudWatch Alarm s·∫Ω k√≠ch ho·∫°t v√† g·ª≠i email c·∫£nh b√°o ƒë·∫øn nh√≥m k·ªπ thu·∫≠t. Nh√≥m k·ªπ thu·∫≠t c√≥ th·ªÉ theo d√µi qu√° tr√¨nh failover sang tunnel d·ª± ph√≤ng v√† th·ª±c hi·ªán c√°c bi·ªán ph√°p kh·∫Øc ph·ª•c. "
},
{
	"uri": "//localhost:1313/vi/6-site-to-site-vpn-lambda-cloudwatch/",
	"title": "Site-to-site VPN v·ªõi Lambda gi√°m s√°t ho·∫°t ƒë·ªông CloudWatch",
	"tags": [],
	"description": "",
	"content": "T·ªïng quan c√°c b∆∞·ªõc (Overview) Ph·∫ßn n√†y gi√∫p b·∫°n n·∫Øm nhanh lu·ªìng c√¥ng vi·ªác v√† c√°c b∆∞·ªõc ch√≠nh trong workshop ‚Äî ƒë·ªçc ph·∫ßn n√†y tr∆∞·ªõc khi th·ª±c hi·ªán c√°c b∆∞·ªõc chi ti·∫øt ph√≠a d∆∞·ªõi.\nM·ª•c ti√™u: tri·ªÉn khai Site‚Äëto‚ÄëSite VPN v·ªõi BGP v√† redundancy, thi·∫øt l·∫≠p gi√°m s√°t, t·ª± ƒë·ªông ho√° failover b·∫±ng Lambda/EventBridge, t·ªëi ∆∞u chi ph√≠ v√† cung c·∫•p runbook x·ª≠ l√Ω s·ª± c·ªë.\nT√≥m t·∫Øt c√°c b∆∞·ªõc ch√≠nh (th·ª© t·ª± khuy·∫øn ngh·ªã):\nChu·∫©n b·ªã \u0026amp; th√¥ng tin ƒë·∫ßu v√†o ‚Äî X√°c ƒë·ªãnh VPC, on‚Äëprem CIDR, public IP c·ªßa router, ASN, EC2 test instance (SSM enabled). T·∫°o v√† c·∫•u h√¨nh VPN (tr√™n VPC Console) ‚Äî T·∫°o VGW, Customer Gateway, v√† VPN Connection (dynamic BGP, 2 tunnels). (Xem c√°c ph·∫ßn chi ti·∫øt tr∆∞·ªõc ƒë√≥ trong t√†i li·ªáu.) X√°c minh BGP \u0026amp; redundancy ‚Äî ƒê·∫£m b·∫£o c·∫£ 2 tunnel UP v√† BGP Established; th·ª≠ m√¥ ph·ªèng failover ƒë·ªÉ ki·ªÉm tra route propagation. Thi·∫øt l·∫≠p gi√°m s√°t ‚Äî T·∫°o CloudWatch metrics \u0026amp; Alarms cho TunnelState, TunnelDataIn/Out; c·∫•u h√¨nh dashboard vpn-dashboard ƒë·ªÉ tr·ª±c quan ho√°. T·ª± ƒë·ªông ho√° x·ª≠ l√Ω s·ª± c·ªë ‚Äî T·∫°o IAM Role cho Lambda (ph·∫ßn L), tri·ªÉn khai Lambda diagnostic (ph·∫ßn M) v√† EventBridge rule (ph·∫ßn E/N) ƒë·ªÉ g·ªçi Lambda khi Alarm ALARM. Test end‚Äëto‚Äëend ‚Äî M√¥ ph·ªèng tunnel down, quan s√°t CloudWatch Alarm ‚Üí EventBridge ‚Üí Lambda ‚Üí SSM invocation v√† k·∫øt qu·∫£ ping/traceroute. T·ªëi ∆∞u chi ph√≠ \u0026amp; logging ‚Äî Thi·∫øt l·∫≠p retention cho CloudWatch Logs, theo d√µi Data Transfer b·∫±ng Cost Explorer, d√πng Budgets/Alerts. Chu·∫©n b·ªã runbook \u0026amp; troubleshooting ‚Äî S·ª≠ d·ª•ng b·∫£ng quick guide (ph·∫ßn 15) ƒë·ªÉ x·ª≠ l√Ω s·ª± c·ªë nhanh. D·ªçn d·∫πp t√†i nguy√™n ‚Äî Sau khi ho√†n th√†nh lab, th·ª±c hi·ªán c√°c b∆∞·ªõc x√≥a resource (Lambda, EventBridge rule, VPN, VGW, CGW, VPC n·∫øu c·∫ßn) ƒë·ªÉ tr√°nh chi ph√≠ ph√°t sinh. L∆∞u √Ω an to√†n \u0026amp; v·∫≠n h√†nh:\nLu√¥n th·ª±c hi·ªán test trong maintenance window v√† th√¥ng b√°o v·ªõi ƒë·ªôi v·∫≠n h√†nh. Kh√¥ng thay ƒë·ªïi c·∫£ hai tunnel c√πng l√∫c khi ki·ªÉm th·ª≠ failover. Gi·ªØ b√≠ m·∫≠t (PSK, webhooks) trong Secrets Manager ‚Äî kh√¥ng l∆∞u v√†o bi·∫øn m√¥i tr∆∞·ªùng plaintext. "
},
{
	"uri": "//localhost:1313/vi/7-cleanup-resource/",
	"title": "D·ªçn d·∫πp t√†i nguy√™n",
	"tags": [],
	"description": "",
	"content": "X√≥a VPC Endpoints Truy c·∫≠p v√†o giao di·ªán Endpoints trong VPC Console Ch·ªçn Action Ch·ªçn Delete VPC endpoints Nh·∫≠p ‚Äúdelete‚Äù ƒë·ªÉ x√°c nh·∫≠n X√≥a c√°c t√†i nguy√™n VPN ‚ÑπÔ∏è Th√¥ng tin: C√°c t√†i nguy√™n VPN c·∫ßn ƒë∆∞·ª£c x√≥a theo th·ª© t·ª± ph√π h·ª£p ƒë·ªÉ tr√°nh l·ªói ph·ª• thu·ªôc.\nX√≥a VPN Site-to-Site connection X√≥a Virtual Private Gateway Tr∆∞·ªõc ti√™n, detach Virtual Private Gateway kh·ªèi VPC (n·∫øu ƒëang attached) Sau ƒë√≥ x√≥a Virtual Private Gateway X√≥a Customer Gateway X√≥a VPC X√≥a VPC ASG VPN X√≥a VPC ASG Xo√° Alarm trong Metrics c·ªßa CloudWatch Ch·ªçn All alarms b√™n tr√°i t·∫°i m·ª•c Alarms, ch·ªçn m·ª•c Alarm c·∫ßn x√≥a r·ªìi ch·ªçn Action, ch·ªçn Delete X√≥a EventBridge Rule M·ªü AWS Management Console. T√¨m v√† ch·ªçn d·ªãch v·ª• Amazon EventBridge. Trong menu b√™n tr√°i, ch·ªçn Rules. Trong danh s√°ch rules, t√¨m Rule ƒë√£ t·∫°o trong workshop (v√≠ d·ª•: Alarm-to-Lambda-Rule). Tick ch·ªçn v√†o checkbox c·ªßa rule ƒë√≥. ·ªû g√≥c tr√™n b√™n ph·∫£i, ch·ªçn Actions ‚Üí Delete. H·ªôp tho·∫°i x√°c nh·∫≠n s·∫Ω xu·∫•t hi·ªán, nh·∫≠p Delete (n·∫øu y√™u c·∫ßu) v√† b·∫•m Delete ƒë·ªÉ x√°c nh·∫≠n x√≥a rule. X√≥a AWS Lambda Function T·ª´ AWS Management Console, t√¨m v√† m·ªü d·ªãch v·ª• Lambda. Trong danh s√°ch functions, t√¨m function ƒë√£ t·∫°o (v√≠ d·ª•: vpn-diagnostic-handler). Click v√†o t√™n function ƒë·ªÉ m·ªü chi ti·∫øt. ·ªû g√≥c tr√™n b√™n ph·∫£i, ch·ªçn Actions ‚Üí Delete function. H·ªôp tho·∫°i x√°c nh·∫≠n xu·∫•t hi·ªán, nh·∫≠p delete (n·∫øu ƒë∆∞·ª£c y√™u c·∫ßu) v√† b·∫•m Delete ƒë·ªÉ x√≥a function. X√≥a IAM Role \u0026amp; Policy T·ª´ AWS Management Console, t√¨m v√† ch·ªçn d·ªãch v·ª• IAM. Trong menu b√™n tr√°i, ch·ªçn Roles. T√¨m IAM Role ƒë√£ t·∫°o cho Lambda (v√≠ d·ª•: lambda-vpn-diagnostic-role). Click v√†o t√™n role ƒë·ªÉ m·ªü chi ti·∫øt. ·ªû g√≥c tr√™n b√™n ph·∫£i, ch·ªçn Delete role. H·ªôp tho·∫°i x√°c nh·∫≠n xu·∫•t hi·ªán, b·∫•m Yes, Delete. N·∫øu role n√†y g·∫Øn v·ªõi custom policy (t·ª± t·∫°o trong workshop): Trong menu b√™n tr√°i c·ªßa IAM, ch·ªçn Policies. T√¨m policy ƒë√£ t·∫°o (v√≠ d·ª•: lambda-vpn-diagnostic-policy). Tick ch·ªçn policy ‚Üí Actions ‚Üí Delete. X√°c nh·∫≠n x√≥a policy. Ki·ªÉm tra t√†i nguy√™n kh√°c (n·∫øu c√≥) N·∫øu trong workshop b·∫°n c√≥ t·∫°o th√™m CloudWatch Alarms, c√≥ th·ªÉ x√≥a ch√∫ng: M·ªü Amazon CloudWatch. Ch·ªçn Alarms ‚Üí t√¨m alarm ƒë√£ t·∫°o ‚Üí ch·ªçn Actions ‚Üí Delete. Ki·ªÉm tra l·∫°i to√†n b·ªô c√°c d·ªãch v·ª• AWS ƒë√£ d√πng trong workshop ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng c√≤n t√†i nguy√™n ho·∫°t ƒë·ªông (VPC, VPN, Gateway, EC2, S3, \u0026hellip; n·∫øu c√≥). üîí Security Note: Khi x√≥a VPC, t·∫•t c·∫£ c√°c t√†i nguy√™n li√™n quan nh∆∞ subnets, route tables, network ACLs, v√† security groups c≈©ng s·∫Ω b·ªã x√≥a. Tuy nhi√™n, c√°c t√†i nguy√™n nh∆∞ NAT Gateways, VPC Endpoints, v√† VPN Connections c·∫ßn ƒë∆∞·ª£c x√≥a ri√™ng tr∆∞·ªõc khi x√≥a VPC.\nL∆ØU √ù: H√£y ki·ªÉm tra t·∫•t c·∫£ c√°c d·ªãch v·ª• l·∫°i 1 l·∫ßn n·ªØa ƒë·ªÉ ch·∫Øc ch·∫Øn r·∫±ng, KH√îNG c√≤n m·ªôt d·ªãch v·ª• n√†o ƒëang ch·∫°y ng·∫ßm ho·∫∑c ch∆∞a x√≥a ƒë·ªÉ kh√¥ng b·ªã t√≠nh ph√≠ l√¢u d√†i.\nKi·ªÉm tra c√°c khu v·ª±c c·ªßa d·ªãch v·ª• AWS ƒë·ªÉ ch·∫Øn ch·∫Øc r·∫±ng b·∫°n KH√îNG b·ªã b·ªè s√≥t d·ªãch v·ª• khi s·ª≠ d·ª•ng t·∫°i khu v·ª±c n√†o kh√°c.\n"
},
{
	"uri": "//localhost:1313/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "//localhost:1313/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]